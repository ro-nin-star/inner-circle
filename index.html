<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title">Perfect Circle - Rajzolj TÃ¶kÃ©letes KÃ¶rt!</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- âœ… GLOBÃLIS LEADERBOARD TÃPUS KÃ–VETÃ‰SE - HTML SZINTEN -->
    <script>
        window.currentLeaderboardType = 'local';
        console.log('ğŸ”§ HTML szintÅ± leaderboard tÃ­pus beÃ¡llÃ­tva:', window.currentLeaderboardType);
    </script>
    <link rel="icon" type="image/x-icon" href="favicon.ico">

</head>

<body>
    <!-- JÃ¡tÃ©kos animÃ¡lt hÃ¡ttÃ©r elemek -->
    <div class="decoration-circle"></div>
    <div class="decoration-circle"></div>
    <div class="decoration-circle"></div>

    <!-- ===== JÃTÃ‰KOS FELSÅ FIX FEJLÃ‰C ===== -->
    <div class="top-fixed-header">
        <!-- Firebase Status -->
        <div class="firebase-status connecting" id="firebaseStatus" data-i18n="firebase.connecting">ğŸŸ¡ KapcsolÃ³dÃ¡s...</div>
        <!-- Nyelv vÃ¡ltÃ³ -->
        <div class="language-selector" id="languageSelector">
            <div class="current-language" onclick="window.i18nManager?.toggleLanguageMenu()">
                <span id="currentLanguageFlag">ğŸ‡­ğŸ‡º</span>
                <span id="currentLanguageCode">HU</span>
            </div>
            <div class="language-menu" id="languageMenu">
                <!-- Dinamikusan tÃ¶ltÅ‘dik a JavaScript Ã¡ltal -->
            </div>
        </div>
    </div>
    <!-- ==================================================== -->

    <div class="game-container" id="gameContainer">
        <h1 data-i18n="title">ğŸ¯ Perfect Circle</h1>
        <p class="subtitle" data-i18n="subtitle">Rajzolj a lehetÅ‘ legtÃ¶kÃ©letesebb kÃ¶rt egyetlen mozdulattal!</p>
        
        <div class="instructions">
            <strong data-i18n="instructions.title">ğŸ® Hogyan jÃ¡tssz:</strong> 
            <span data-i18n="instructions.text">Kattints Ã©s hÃºzd az egeret (vagy Ã©rintsd Ã©s hÃºzd az ujjad) hogy egy kÃ¶rt rajzolj. MinÃ©l tÃ¶kÃ©letesebb a kÃ¶rÃ¶d, annÃ¡l tÃ¶bb pontot kapsz! A kÃ¶r varÃ¡zslatos mÃ³don Ã¡t fog vÃ¡ltozni! âœ¨</span>
        </div>

        <!-- Offline notice -->
        <div class="offline-notice" id="offlineNotice" style="display: none;">
            <span data-i18n="firebase.offlineNotice">âš ï¸ <strong>Offline mÃ³d:</strong> A globÃ¡lis ranglista nem elÃ©rhetÅ‘. Az eredmÃ©nyek helyben mentÅ‘dnek.</span>
        </div>

        <!-- PLAYER NAME SECTION -->
        <div class="player-name-section">
            <label for="playerName"><strong data-i18n="player.label">ğŸ‘¤ JÃ¡tÃ©kos nÃ©v:</strong></label>
            <input type="text" id="playerName" class="player-name-input" data-i18n="player.placeholder" placeholder="Add meg a neved" maxlength="20" value="">
            <button id="saveNameBtn" data-i18n="buttons.save">ğŸ’¾ MentÃ©s</button>
        </div>

        <div class="difficulty-selector">
            <strong data-i18n="difficulty.label">ğŸ¯ NehÃ©zsÃ©g:</strong><br>
            <button class="difficulty-btn active" onclick="setDifficulty('easy')" data-difficulty="easy" data-i18n="difficulty.easy">KÃ¶nnyÅ± ğŸ˜Š</button>
            <button class="difficulty-btn" onclick="setDifficulty('hard')" data-difficulty="hard" data-i18n="difficulty.hard">NehÃ©z ğŸŒ€</button>
        </div>
<!-- ğŸ¯ RAJZOLÃS GOMB - FELÃœL -->
    <div class="draw-start-container">
        <div class="arrow arrow-left">ğŸ‘ˆ</div>
        <div class="arrow arrow-top">ğŸ‘†</div>
        <button class="draw-start-button" id="startDrawingBtn" onclick="startDrawing()">
            ğŸ¨ Kezdj Rajzolni! ğŸ¨
        </button>
        <div class="arrow arrow-right">ğŸ‘‰</div>
        <div class="arrow arrow-bottom">ğŸ‘‡</div>
    </div>
<!-- âœ… JAVÃTOTT STATISZTIKÃK HTML -->
<div class="stats-container">
    <div class="stat-item">
        <div class="stat-label">Jelenlegi</div>
        <div class="stat-value" id="currentScore">0</div>
    </div>
    <div class="stat-item">
        <div class="stat-label">Legjobb</div>
        <div class="stat-value" id="bestScore">0</div>
    </div>
    <div class="stat-item">
        <div class="stat-label">JÃ¡tÃ©kok</div>
        <div class="stat-value" id="gamesPlayed">0</div>
    </div>
    <div class="stat-item">
        <div class="stat-label">Ãtlag</div>
        <div class="stat-value" id="averageScore">0</div>
    </div>
</div>


        <!-- âœ… NÃ‰GYZETES CANVAS CONTAINER -->
        <div class="canvas-container">
            <canvas id="gameCanvas" width="460" height="460"></canvas>
            <canvas id="idealCircleCanvas" width="460" height="460"></canvas>
            <div class="canvas-overlay" id="canvasOverlay"></div>
            <div class="transformation-overlay" id="transformationOverlay">
                <div class="transformation-content">
                    <h2 id="transformationText" data-i18n="transformation.magic">âœ¨ VarÃ¡zslat tÃ¶rtÃ©nik... âœ¨</h2>
                </div>
            </div>
        </div>

        <div class="controls">
            <button id="startBtn" data-i18n="buttons.startDrawing" >ğŸ¯ RajzolÃ¡s KezdÃ©se</button>
            <button id="clearBtn" disabled data-i18n="buttons.clear">ğŸ—‘ï¸ TÃ¶rlÃ©s</button>
            <button id="helpBtn" data-i18n="buttons.help">â“ SegÃ­tsÃ©g</button>
            <button id="clearScoresBtn" data-i18n="buttons.clearScores">ğŸ—‘ï¸ Helyi EredmÃ©nyek TÃ¶rlÃ©se</button>
        </div>

        <!-- PontszÃ¡m megjelenÃ­tÅ‘ -->
        <div class="score-display" id="scoreDisplay" style="display: none;">
            <h3 id="scoreTitle" data-i18n="scoreTitle.result">ğŸ† EredmÃ©ny</h3>
            <div class="score-number">
                <span id="finalScore">0</span>/100 <span data-i18n="common.points">pont</span>
            </div>
            <div class="score-breakdown" id="scoreBreakdown">
                <!-- Dinamikusan tÃ¶ltÅ‘dik -->
            </div>
            
            <!-- IdeÃ¡lis kÃ¶r Ã¶sszehasonlÃ­tÃ¡s -->
            <div id="idealCircleContainer" class="ideal-circle-container" style="display: none;">
                <h4 data-i18n="analysis.idealCircle">IdeÃ¡lis kÃ¶r Ã¶sszehasonlÃ­tÃ¡s:</h4>
                <div class="ideal-circle-canvas-container">
                    <canvas id="idealComparisonCanvas" width="200" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- LEADERBOARD WITH TABS -->
        <div class="leaderboard">
            <h3 data-i18n="leaderboard.title">ğŸ† Ranglista</h3>
            <div class="leaderboard-tabs">
                <button id="localTab" class="tab-btn active">
                    ğŸ“± Helyi
                </button>
                <button id="globalTab" class="tab-btn">
                    ğŸŒ GlobÃ¡lis
                </button>
            </div>

            <div class="leaderboard-status" id="leaderboardStatus" data-i18n="leaderboard.localResults">
                ğŸ“± Helyi eredmÃ©nyek
            </div>
            <div id="leaderboardList">
                <div class="score-entry">
                    <span data-i18n="leaderboard.noResults">MÃ©g nincsenek eredmÃ©nyek</span>
                </div>
            </div>
        </div>

        <!-- RÃ©szletes instrukciÃ³k -->
        <div class="detailed-instructions">
            <h3 data-i18n="instructions.detailedTitle">ğŸ“– RÃ©szletes ÃštmutatÃ³</h3>
            <div class="instruction-section">
                <h4 data-i18n="instructions.gameplayTitle">ğŸ® JÃ¡tÃ©kmenet:</h4>
                <ul>
                    <li data-i18n="instructions.step1">Kattints a "RajzolÃ¡s KezdÃ©se" gombra</li>
                    <li data-i18n="instructions.step2">Rajzolj egy kÃ¶rt egyetlen mozdulattal</li>
                    <li data-i18n="instructions.step3">NÃ©zd meg az eredmÃ©nyed Ã©s a transzformÃ¡ciÃ³t!</li>
                </ul>
            </div>
            
            <div class="instruction-section">
                <h4 data-i18n="instructions.scoringTitle">ğŸ“Š PontszÃ¡mÃ­tÃ¡s:</h4>
                <ul>
                    <li data-i18n="instructions.shapeScore">ğŸ”µ KÃ¶ralak (40 pont): Mennyire hasonlÃ­t kÃ¶rre</li>
                    <li data-i18n="instructions.closureScore">ğŸ”— ZÃ¡rÃ³dÃ¡s (20 pont): Mennyire zÃ¡rt a forma</li>
                    <li data-i18n="instructions.smoothnessScore">ğŸŒŠ EgyenletessÃ©g (25 pont): Mennyire egyenletes a vonal</li>
                    <li data-i18n="instructions.sizeScore">ğŸ“ MÃ©ret (15 pont): OptimÃ¡lis mÃ©ret hasznÃ¡lata</li>
                </ul>
            </div>
            
            <div class="instruction-section">
                <h4 data-i18n="instructions.transformationsTitle">ğŸ¨ TranszformÃ¡ciÃ³k:</h4>
                <p data-i18n="instructions.transformationsText">70+ pont esetÃ©n a kÃ¶rÃ¶d varÃ¡zslatos alakzattÃ¡ vÃ¡ltozik! Minden transzformÃ¡ciÃ³ utÃ¡n egy mosolygÃ³ arc jelenik meg! ğŸ˜Š</p>
            </div>
            
            <div class="instruction-section">
                <h4 data-i18n="instructions.controlsTitle">âŒ¨ï¸ BillentyÅ± parancsok:</h4>
                <ul>
                    <li data-i18n="instructions.ctrlS">Ctrl+S: RajzolÃ¡s kezdÃ©se</li>
                    <li data-i18n="instructions.ctrlR">Ctrl+R: TÃ¶rlÃ©s</li>
                    <li data-i18n="instructions.ctrlH">Ctrl+H: SegÃ­tsÃ©g</li>
                    <li data-i18n="instructions.ctrlL">Ctrl+L: Nyelv menÃ¼</li>
                    <li data-i18n="instructions.escape">Esc: JÃ¡tÃ©k megszakÃ­tÃ¡sa</li>
                    <li data-i18n="instructions.f1">F1: SegÃ­tsÃ©g</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- LÃ¡togatÃ¡sszÃ¡mlÃ¡lÃ³ -->
    <div class="visitor-counter" id="visitorCounter" onclick="showVisitStats()">
        <span data-i18n="visitors.label">ğŸ‘¥ LÃ¡togatÃ¡sok:</span> <span class="visitor-number" id="visitCount">0</span>
    </div>

    <!-- FejlesztÅ‘i informÃ¡ciÃ³k -->
    <div class="dev-info">
        <span data-i18n="dev.version">v2.1</span> | 
        <span onclick="window.debugGameEngine?.()" data-i18n="dev.debug">Debug</span>
    </div>

    <!-- JavaScript fÃ¡jlok betÃ¶ltÃ©se -->
    <script>
        // GlobÃ¡lis nyelvi adatok tÃ¡rolÃ³ja
        window.languageData = {};
        
        // Magyar nyelv beÃ¡gyazÃ¡sa (egyszerÅ±sÃ­tett verziÃ³)
        window.languageData.hu = {
            title: "Perfect Circle - Rajzolj TÃ¶kÃ©letes KÃ¶rt!",
            subtitle: "Rajzolj a lehetÅ‘ legtÃ¶kÃ©letesebb kÃ¶rt egyetlen mozdulattal!",
            instructions: {
                title: "ğŸ® Hogyan jÃ¡tssz:",
                text: "Kattints Ã©s hÃºzd az egeret (vagy Ã©rintsd Ã©s hÃºzd az ujjad) hogy egy kÃ¶rt rajzolj. MinÃ©l tÃ¶kÃ©letesebb a kÃ¶rÃ¶d, annÃ¡l tÃ¶bb pontot kapsz! A kÃ¶r varÃ¡zslatos mÃ³don Ã¡t fog vÃ¡ltozni! âœ¨"
            },
            buttons: {
                startDrawing: "ğŸ¯ RajzolÃ¡s KezdÃ©se",
                clear: "ğŸ—‘ï¸ TÃ¶rlÃ©s",
                help: "â“ SegÃ­tsÃ©g",
                save: "ğŸ’¾ MentÃ©s",
                clearScores: "ğŸ—‘ï¸ Helyi EredmÃ©nyek TÃ¶rlÃ©se"
            },
            player: {
                label: "ğŸ‘¤ JÃ¡tÃ©kos nÃ©v:",
                placeholder: "Add meg a neved"
            },
            difficulty: {
                label: "ğŸ¯ NehÃ©zsÃ©g:",
                easy: "KÃ¶nnyÅ± ğŸ˜Š",
                hard: "NehÃ©z ğŸŒ€"
            },
            stats: {
                currentScore: "Jelenlegi PontszÃ¡m",
                bestScore: "Legjobb EredmÃ©ny",
                gamesPlayed: "JÃ¡tÃ©kok SzÃ¡ma",
                averageScore: "Ãtlag PontszÃ¡m"
            },
            leaderboard: {
                title: "ğŸ† Ranglista",
                localResults: "ğŸ“± Helyi eredmÃ©nyek",
                noResults: "MÃ©g nincsenek eredmÃ©nyek"
            },
            common: {
                points: "pont"
            },
            scoreTitle: {
                result: "ğŸ† EredmÃ©ny"
            },
            transformation: {
                magic: "âœ¨ VarÃ¡zslat tÃ¶rtÃ©nik... âœ¨"
            },
            firebase: {
                connecting: "ğŸŸ¡ KapcsolÃ³dÃ¡s...",
                offlineNotice: "âš ï¸ <strong>Offline mÃ³d:</strong> A globÃ¡lis ranglista nem elÃ©rhetÅ‘. Az eredmÃ©nyek helyben mentÅ‘dnek."
            },
            visitors: {
                label: "ğŸ‘¥ LÃ¡togatÃ¡sok:"
            },
            dev: {
                version: "v2.1",
                debug: "Debug"
            }
        };
    </script>

    <!-- THUMBNAIL GENERATOR BEÃGYAZVA -->
    <script>
        // js/utils/thumbnailGenerator.js - BEÃGYAZVA
        window.ThumbnailGenerator = {
            
            // Canvas tartalom mentÃ©se thumbnail-kÃ©nt
            captureCanvasThumbnail: function(canvasId, maxWidth = 100, maxHeight = 100, quality = 0.8) {
                try {
                    const canvas = document.getElementById(canvasId);
                    if (!canvas) {
                        console.error('âŒ Canvas nem talÃ¡lhatÃ³:', canvasId);
                        return null;
                    }
                    
                    // Thumbnail canvas lÃ©trehozÃ¡sa
                    const thumbCanvas = document.createElement('canvas');
                    const thumbCtx = thumbCanvas.getContext('2d');
                    
                    // ArÃ¡nyos Ã¡tmÃ©retezÃ©s szÃ¡mÃ­tÃ¡sa
                    const originalWidth = canvas.width;
                    const originalHeight = canvas.height;
                    const aspectRatio = originalWidth / originalHeight;
                    
                    let thumbWidth = maxWidth;
                    let thumbHeight = maxHeight;
                    
                    if (aspectRatio > 1) {
                        thumbHeight = maxWidth / aspectRatio;
                    } else {
                        thumbWidth = maxHeight * aspectRatio;
                    }
                    
                    thumbCanvas.width = Math.round(thumbWidth);
                    thumbCanvas.height = Math.round(thumbHeight);
                    
                    // HÃ¡ttÃ©r beÃ¡llÃ­tÃ¡sa (Ã¡tlÃ¡tszÃ³ helyett fehÃ©r)
                    thumbCtx.fillStyle = '#ffffff';
                    thumbCtx.fillRect(0, 0, thumbCanvas.width, thumbCanvas.height);
                    
                    // Eredeti canvas tartalom Ã¡tmÃ¡solÃ¡sa
                    thumbCtx.drawImage(canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);
                    
                    // Base64 string visszaadÃ¡sa
                    const thumbnailData = thumbCanvas.toDataURL('image/jpeg', quality);
                    
                    console.log('âœ… Thumbnail kÃ©szÃ­tve:', {
                        originalSize: `${originalWidth}x${originalHeight}`,
                        thumbnailSize: `${thumbCanvas.width}x${thumbCanvas.height}`,
                        dataSize: Math.round(thumbnailData.length / 1024) + 'KB'
                    });
                    
                    return thumbnailData;
                    
                } catch (error) {
                    console.error('âŒ Thumbnail kÃ©szÃ­tÃ©si hiba:', error);
                    return null;
                }
            },

            // TranszformÃ¡ciÃ³ utÃ¡n thumbnail kÃ©szÃ­tÃ©s
            captureTransformationThumbnail: function(delay = 500) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        // PrÃ³bÃ¡ljuk meg a gameCanvas-rÃ³l
                        let thumbnail = this.captureCanvasThumbnail('gameCanvas');
                        
                        // Ha nincs, prÃ³bÃ¡ljuk az idealCircleCanvas-rÃ³l
                        if (!thumbnail) {
                            thumbnail = this.captureCanvasThumbnail('idealCircleCanvas');
                        }
                        
                        resolve(thumbnail);
                    }, delay);
                });
            },

            // Thumbnail megjelenÃ­tÃ©se DOM elemben
            displayThumbnail: function(thumbnailData, containerId, className = 'score-thumbnail') {
                try {
                    if (!thumbnailData) return false;
                    
                    const container = document.getElementById(containerId);
                    if (!container) return false;
                    
                    // MeglÃ©vÅ‘ thumbnail eltÃ¡volÃ­tÃ¡sa
                    const existingThumbnail = container.querySelector('.' + className);
                    if (existingThumbnail) {
                        existingThumbnail.remove();
                    }
                    
                    // Ãšj thumbnail elem lÃ©trehozÃ¡sa
                    const img = document.createElement('img');
                    img.src = thumbnailData;
                    img.className = className;
                    img.style.cssText = `
                        width: 60px;
                        height: 60px;
                        object-fit: cover;
                        border-radius: 8px;
                        border: 2px solid #ddd;
                        margin-left: 10px;
                        cursor: pointer;
                        transition: transform 0.2s;
                    `;
                    
                    // Hover effekt
                    img.addEventListener('mouseenter', () => {
                        img.style.transform = 'scale(1.1)';
                    });
                    
                    img.addEventListener('mouseleave', () => {
                        img.style.transform = 'scale(1)';
                    });
                    
                    // KattintÃ¡sra nagyÃ­tÃ¡s
                    img.addEventListener('click', () => {
                        this.showThumbnailModal(thumbnailData);
                    });
                    
                    container.appendChild(img);
                    return true;
                    
                } catch (error) {
                    console.error('âŒ Thumbnail megjelenÃ­tÃ©si hiba:', error);
                    return false;
                }
            },

            // Thumbnail modal megjelenÃ­tÃ©se
            showThumbnailModal: function(thumbnailData) {
                // Modal lÃ©trehozÃ¡sa
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    cursor: pointer;
                `;
                
                const img = document.createElement('img');
                img.src = thumbnailData;
                img.style.cssText = `
                    max-width: 90%;
                    max-height: 90%;
                    border-radius: 10px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
                `;
                
                modal.appendChild(img);
                document.body.appendChild(modal);
                
                // KattintÃ¡sra bezÃ¡rÃ¡s
                modal.addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                // ESC billentyÅ±re bezÃ¡rÃ¡s
                const escHandler = (e) => {
                    if (e.key === 'Escape') {
                        document.body.removeChild(modal);
                        document.removeEventListener('keydown', escHandler);
                    }
                };
                document.addEventListener('keydown', escHandler);
            }
        };

        console.log('âœ… ThumbnailGenerator betÃ¶ltve');
    </script>

    <!-- SCORE ANIMATOR -->
    <script>
        window.ScoreAnimator = {
            
            // FÅ‘bb animÃ¡ciÃ³ indÃ­tÃ¡sa
            animateScore: function(score, breakdown, transformationName = '') {
                console.log('ğŸ‰ Score animÃ¡ciÃ³ indÃ­tÃ¡sa:', score);
                
                try {
                    // Score kategÃ³ria meghatÃ¡rozÃ¡sa
                    const category = this.getScoreCategory(score);
                    
                    // Nagy score felfedÃ©s
                    this.showBigScoreReveal(score, category);
                    
                    // RÃ©szletek animÃ¡lÃ¡sa
                    setTimeout(() => {
                        this.animateScoreBreakdown(breakdown);
                    }, 1500);
                    
                    // EgyÃ©b effektek
                    setTimeout(() => {
                        this.addScoreEffects(score, category);
                    }, 500);
                    
                    // Score display animÃ¡lÃ¡sa
                    setTimeout(() => {
                        this.animateScoreDisplay(score, category);
                    }, 2000);
                    
                } catch (error) {
                    console.error('âŒ Score animÃ¡ciÃ³ hiba:', error);
                }
            },
            
            // Score kategÃ³ria meghatÃ¡rozÃ¡sa
            getScoreCategory: function(score) {
                if (score >= 95) return { name: 'perfect', text: 'TÃ–KÃ‰LETES!', emoji: 'ğŸ†' };
                if (score >= 85) return { name: 'excellent', text: 'KIVÃLÃ“!', emoji: 'â­' };
                if (score >= 70) return { name: 'good', text: 'JÃ“!', emoji: 'ğŸ‘' };
                if (score >= 50) return { name: 'fair', text: 'ELFOGADHATÃ“', emoji: 'ğŸ‘Œ' };
                return { name: 'poor', text: 'GYAKOROLJ MÃ‰G!', emoji: 'ğŸ’ª' };
            },
            
            // Nagy score felfedÃ©s
            showBigScoreReveal: function(score, category) {
                // Overlay lÃ©trehozÃ¡sa
                const overlay = document.createElement('div');
                overlay.className = 'score-animation-overlay';
                
                // Score szÃ¶veg
                const scoreText = document.createElement('div');
                scoreText.className = `score-big-reveal score-${category.name}`;
                scoreText.innerHTML = `
                    <div style="font-size: 0.3em; margin-bottom: 10px;">${category.emoji} ${category.text} ${category.emoji}</div>
                    <div>${Math.round(score)}</div>
                    <div style="font-size: 0.4em; margin-top: 10px;">PONT</div>
                `;
                
                overlay.appendChild(scoreText);
                document.body.appendChild(overlay);
                
                // Hang lejÃ¡tszÃ¡sa (ha van AudioManager)
                if (window.AudioManager && window.AudioManager.playScoreReveal) {
                    window.AudioManager.playScoreReveal(score);
                }
                
                // EltÃ¡volÃ­tÃ¡s
                setTimeout(() => {
                    if (overlay.parentNode) {
                        overlay.parentNode.removeChild(overlay);
                    }
                }, 3000);
            },
            
            // Score breakdown animÃ¡lÃ¡sa
            animateScoreBreakdown: function(breakdown) {
                const scoreBreakdown = document.getElementById('scoreBreakdown');
                if (!scoreBreakdown || !breakdown) return;
                
                // Elemek animÃ¡lÃ¡sa egyenkÃ©nt
                const items = scoreBreakdown.querySelectorAll('div');
                items.forEach((item, index) => {
                    item.style.opacity = '0';
                    item.style.transform = 'translateX(-50px)';
                    item.style.transition = 'all 0.5s ease';
                    
                    setTimeout(() => {
                        item.style.opacity = '1';
                        item.style.transform = 'translateX(0)';
                    }, index * 200);
                });
            },
            
            // Score display animÃ¡lÃ¡sa
            animateScoreDisplay: function(score, category) {
                const scoreDisplay = document.getElementById('scoreDisplay');
                if (!scoreDisplay) return;
                
                // CSS class hozzÃ¡adÃ¡sa
                scoreDisplay.classList.add('score-revealed');
                
                // Badge hozzÃ¡adÃ¡sa
                this.addScoreBadge(scoreDisplay, category);
                
                // Class eltÃ¡volÃ­tÃ¡sa
                setTimeout(() => {
                    scoreDisplay.classList.remove('score-revealed');
                }, 2000);
            },
            
            // Score badge hozzÃ¡adÃ¡sa
            addScoreBadge: function(container, category) {
                // MeglÃ©vÅ‘ badge eltÃ¡volÃ­tÃ¡sa
                const existingBadge = container.querySelector('.score-grade-badge');
                if (existingBadge) {
                    existingBadge.remove();
                }
                
                // Ãšj badge
                const badge = document.createElement('div');
                badge.className = 'score-grade-badge';
                badge.textContent = category.emoji + ' ' + category.text;
                
                container.style.position = 'relative';
                container.appendChild(badge);
                
                // Badge eltÃ¡volÃ­tÃ¡sa
                setTimeout(() => {
                    if (badge.parentNode) {
                        badge.parentNode.removeChild(badge);
                    }
                }, 3000);
            },
            
            // EgyÃ©b effektek
            addScoreEffects: function(score, category) {
                // Particle effekt
                this.createParticles(score);
                
                // Confetti nagy score esetÃ©n
                if (score >= 80) {
                    this.createConfetti();
                }
                
                // TÅ±zijÃ¡tÃ©k tÃ¶kÃ©letes score esetÃ©n
                if (score >= 95) {
                    this.createFireworks();
                }
            },
            
            // Particle effekt
            createParticles: function(score) {
                const container = document.createElement('div');
                container.className = 'score-particles';
                
                const particleCount = Math.min(score / 2, 50);
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'score-particle';
                    
                    // Random pozÃ­ciÃ³ Ã©s irÃ¡ny
                    const angle = (Math.PI * 2 * i) / particleCount;
                    const distance = 100 + Math.random() * 100;
                    const dx = Math.cos(angle) * distance;
                    const dy = Math.sin(angle) * distance;
                    
                    particle.style.setProperty('--dx', dx + 'px');
                    particle.style.setProperty('--dy', dy + 'px');
                    particle.style.backgroundColor = this.getRandomColor();
                    particle.style.animationDelay = Math.random() * 0.5 + 's';
                    
                    container.appendChild(particle);
                }
                
                document.body.appendChild(container);
                
                // EltÃ¡volÃ­tÃ¡s
                setTimeout(() => {
                    if (container.parentNode) {
                        container.parentNode.removeChild(container);
                    }
                }, 2000);
            },
            
            // Confetti lÃ©trehozÃ¡sa
            createConfetti: function() {
                const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'];
                
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.animationDelay = Math.random() * 2 + 's';
                        
                        document.body.appendChild(confetti);
                        
                        setTimeout(() => {
                            if (confetti.parentNode) {
                                confetti.parentNode.removeChild(confetti);
                            }
                        }, 3000);
                    }, i * 50);
                }
            },
            
            // TÅ±zijÃ¡tÃ©k
            createFireworks: function() {
                const colors = ['#FFD700', '#FF1744', '#00E676', '#2196F3', '#FF9800'];
                
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const container = document.createElement('div');
                        container.className = 'score-fireworks';
                        
                        const centerX = Math.random() * window.innerWidth;
                        const centerY = Math.random() * window.innerHeight * 0.5 + window.innerHeight * 0.2;
                        
                        for (let j = 0; j < 20; j++) {
                            const firework = document.createElement('div');
                            firework.className = 'firework';
                            firework.style.left = centerX + 'px';
                            firework.style.top = centerY + 'px';
                            firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                            firework.style.animationDelay = Math.random() * 0.5 + 's';
                            
                            container.appendChild(firework);
                        }
                        
                        document.body.appendChild(container);
                        
                        setTimeout(() => {
                            if (container.parentNode) {
                                container.parentNode.removeChild(container);
                            }
                        }, 1500);
                    }, i * 300);
                }
            },
            
            // Random szÃ­n
            getRandomColor: function() {
                const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
                return colors[Math.floor(Math.random() * colors.length)];
            },
            
            // VibrÃ¡ciÃ³ (mobil)
            vibrate: function(score) {
                if (navigator.vibrate) {
                    if (score >= 95) {
                        navigator.vibrate([200, 100, 200, 100, 200]);
                    } else if (score >= 80) {
                        navigator.vibrate([100, 50, 100]);
                    } else if (score >= 60) {
                        navigator.vibrate(100);
                    }
                }
            }
        };

        console.log('âœ… ScoreAnimator betÃ¶ltve');
    </script>

    <!-- âœ… BEÃGYAZOTT VISITOR COUNTER -->
    <script>
        // âœ… BEÃGYAZOTT VISITOR COUNTER OSZTÃLY
        if (!window.VisitorCounter) {
            console.log('ğŸ”§ VisitorCounter beÃ¡gyazÃ¡sa...');
            
            class VisitorCounter {
                static STORAGE_KEY = 'perfectcircle_visits';
                static SESSION_KEY = 'perfectcircle_session';
                static currentCount = 0;
                static globalCount = 0;
                
                static async init() {
                    console.log('ğŸ‘ï¸ BeÃ¡gyazott VisitorCounter inicializÃ¡lÃ¡sa...');
                    
                    try {
                        // Helyi lÃ¡togatÃ¡sszÃ¡m frissÃ­tÃ©se
                        this.currentCount = this.updateLocalVisitCount();
                        
                        // Firebase lÃ¡togatÃ¡s mentÃ©se (ha elÃ©rhetÅ‘)
                        if (window.firebaseAPI && window.firebaseAPI.isReady && window.firebaseAPI.isReady()) {
                            await this.saveVisitToFirebase();
                            await this.loadGlobalVisitCount();
                        } else {
                            console.log('ğŸ“´ Firebase nem elÃ©rhetÅ‘, csak helyi szÃ¡mlÃ¡lÃ³');
                        }
                        
                        console.log('âœ… BeÃ¡gyazott VisitorCounter inicializÃ¡lva');
                        return true;
                        
                    } catch (error) {
                        console.error('âŒ BeÃ¡gyazott VisitorCounter hiba:', error);
                        throw error;
                    }
                }
                
                static updateLocalVisitCount() {
                    let localVisits = parseInt(localStorage.getItem(this.STORAGE_KEY) || '0');
                    localVisits++;
                    localStorage.setItem(this.STORAGE_KEY, localVisits.toString());
                    
                    // IdÅ‘pontok mentÃ©se
                    if (!localStorage.getItem('perfectcircle_first_visit')) {
                        localStorage.setItem('perfectcircle_first_visit', new Date().toISOString());
                    }
                    localStorage.setItem('perfectcircle_last_visit', new Date().toISOString());
                    
                    // DOM frissÃ­tÃ©s
                    const visitElement = document.getElementById('visitCount');
                    if (visitElement) {
                        visitElement.textContent = localVisits.toLocaleString('hu-HU');
                    }
                    
                    console.log(`ğŸ“Š Helyi lÃ¡togatÃ¡sok: ${localVisits}`);
                    return localVisits;
                }
                
                static async saveVisitToFirebase() {
                    if (!window.firebaseAPI || !window.firebaseAPI.saveVisit) {
                        console.log('ğŸ“´ Firebase saveVisit nem elÃ©rhetÅ‘');
                        return;
                    }
                    
                    try {
                        const visitData = {
                            timestamp: new Date().toISOString(),
                            date: new Date().toLocaleDateString('hu-HU'),
                            time: new Date().toLocaleTimeString('hu-HU'),
                            sessionId: this.getSessionId(),
                            userAgent: navigator.userAgent.substring(0, 200),
                            language: navigator.language,
                            screen: `${screen.width}x${screen.height}`,
                            viewport: `${window.innerWidth}x${window.innerHeight}`,
                            referrer: (document.referrer || 'kÃ¶zvetlen').substring(0, 200),
                            url: window.location.href,
                            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                            platform: navigator.platform
                        };
                        
                        await window.firebaseAPI.saveVisit(visitData);
                        console.log('âœ… LÃ¡togatÃ¡s mentve Firebase-be');
                        
                    } catch (error) {
                        console.error('âŒ Firebase lÃ¡togatÃ¡s mentÃ©si hiba:', error);
                    }
                }
                
                static async loadGlobalVisitCount() {
                    if (!window.firebaseAPI || !window.firebaseAPI.getVisitCount) {
                        console.log('ğŸ“´ Firebase getVisitCount nem elÃ©rhetÅ‘');
                        return;
                    }
                    
                    try {
                        const globalCount = await window.firebaseAPI.getVisitCount();
                        this.globalCount = globalCount;
                        console.log(`ğŸŒ GlobÃ¡lis lÃ¡togatÃ¡sok: ${globalCount}`);
                        
                    } catch (error) {
                        console.error('âŒ GlobÃ¡lis lÃ¡togatÃ¡sszÃ¡m lekÃ©rÃ©si hiba:', error);
                    }
                }
                
                static getSessionId() {
                    let sessionId = sessionStorage.getItem(this.SESSION_KEY);
                    if (!sessionId) {
                        sessionId = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
                        sessionStorage.setItem(this.SESSION_KEY, sessionId);
                    }
                    return sessionId;
                }
                
                static getCurrentCount() {
                    return this.currentCount;
                }
                
                static getGlobalCount() {
                    return this.globalCount;
                }
                
                static showStats() {
                    const localVisits = localStorage.getItem(this.STORAGE_KEY) || 0;
                    const firstVisit = localStorage.getItem('perfectcircle_first_visit');
                    const lastVisit = localStorage.getItem('perfectcircle_last_visit');
                    
                    let message = `ğŸ‘¥ LÃ¡togatÃ¡si statisztikÃ¡k:\n\n`;
                    message += `ğŸ”¢ Helyi lÃ¡togatÃ¡sok: ${localVisits}\n`;
                    
                    if (this.globalCount > 0) {
                        message += `ğŸŒ GlobÃ¡lis lÃ¡togatÃ¡sok: ${this.globalCount.toLocaleString('hu-HU')}\n`;
                    }
                    
                    if (firstVisit) {
                        const firstDate = new Date(firstVisit);
                        message += `ğŸ†• ElsÅ‘ lÃ¡togatÃ¡s: ${firstDate.toLocaleDateString('hu-HU')}\n`;
                    }
                    
                    if (lastVisit) {
                        const lastDate = new Date(lastVisit);
                        message += `ğŸ• UtolsÃ³ lÃ¡togatÃ¡s: ${lastDate.toLocaleDateString('hu-HU')} ${lastDate.toLocaleTimeString('hu-HU')}\n`;
                    }
                    
                    const sessionId = this.getSessionId();
                    message += `ğŸ†” Session ID: ${sessionId.substring(0, 8)}...`;
                    
                    alert(message);
                }
            }
            
            // GlobÃ¡lis export
            window.VisitorCounter = VisitorCounter;
            console.log('âœ… BeÃ¡gyazott VisitorCounter lÃ©trehozva');
        }
    </script>

    <script src="js/i18n/languageDetector.js"></script>
    <script src="js/i18n/i18nManager.js"></script>
    
    <!-- Firebase Scripts -->
    <script src="js/firebase/firebase-config.js" type="module"></script>
    
    <!-- Utility Scripts -->
    <script src="js/utils/audioManager.js"></script>
    <script src="js/utils/effectsManager.js"></script>
    
    <!-- Game Scripts -->
    <script src="js/game/transformations.js"></script>
    <script src="js/game/circleAnalyzer.js"></script>
    <script src="js/game/gameEngine.js"></script>
    
    <!-- Manager Scripts -->
    <script src="js/managers/scoreManager.js"></script>
    <script src="js/managers/visitorCounter.js"></script>
    <script src="js/managers/leaderboardManager.js"></script>

    <script src="leaderboard-fix.js"></script>

    <!-- Main App Script UTOLJÃRA -->
    <script src="js/app.js" type="module"></script>

    <!-- FIREBASE GLOBÃLIS LEADERBOARD TÃMOGATÃS -->
    <script>
        // VÃ¡rakozÃ¡s a Firebase API-ra
        function waitForFirebaseAPI() {
            return new Promise((resolve) => {
                let attempts = 0;
                const maxAttempts = 100;
                
                const checkAPI = () => {
                    attempts++;
                    
                    if (window.firebaseAPI && typeof window.firebaseAPI.isReady === 'function') {
                        console.log('âœ… Firebase API elÃ©rhetÅ‘ globÃ¡lis leaderboard-hoz!');
                        resolve(true);
                    } else if (attempts >= maxAttempts) {
                        console.error('âŒ Firebase API timeout!');
                        resolve(false);
                    } else {
                        setTimeout(checkAPI, 100);
                    }
                };
                checkAPI();
            });
        }

        // âœ… JAVÃTOTT GLOBÃLIS LEADERBOARD BETÃ–LTÃ‰SE
        window.loadGlobalLeaderboard = async function() {
            console.log('ğŸŒ GlobÃ¡lis leaderboard betÃ¶ltÃ©se...');
            
            // âœ… AZONNAL BEÃLLÃTJUK A TÃPUST
            window.currentLeaderboardType = 'global';
            
            const leaderboardList = document.getElementById('leaderboardList');
            const leaderboardStatus = document.getElementById('leaderboardStatus');
            
            if (!leaderboardList) return;
            
            // Loading Ã¡llapot
            leaderboardList.innerHTML = '<div class="score-entry">ğŸ”„ GlobÃ¡lis eredmÃ©nyek betÃ¶ltÃ©se...</div>';
            if (leaderboardStatus) {
                leaderboardStatus.textContent = 'ğŸŒ GlobÃ¡lis eredmÃ©nyek betÃ¶ltÃ©se...';
            }
            
            try {
                // VÃ¡runk a Firebase API-ra
                const apiReady = await waitForFirebaseAPI();
                
                if (!apiReady || !window.firebaseAPI.isReady()) {
                    throw new Error('Firebase nem elÃ©rhetÅ‘');
                }
                
                // GlobÃ¡lis eredmÃ©nyek lekÃ©rÃ©se
                const globalScores = await window.firebaseAPI.getTopScores(20);
                
                console.log('âœ… GlobÃ¡lis eredmÃ©nyek betÃ¶ltve:', globalScores.length);
                
                // âœ… ELLENÅRIZZÃœK HOGY MÃ‰G MINDIG GLOBÃLIS MÃ“DBAN VAGYUNK
                if (window.currentLeaderboardType !== 'global') {
                    console.log('âš ï¸ MÃ¡r nem globÃ¡lis mÃ³dban vagyunk, leÃ¡llÃ­tÃ¡s...');
                    return;
                }
                
                // Status frissÃ­tÃ©s
                if (leaderboardStatus) {
                    leaderboardStatus.textContent = `ğŸŒ ${globalScores.length} globÃ¡lis eredmÃ©ny`;
                }
                
                // Lista megjelenÃ­tÃ©se
                if (globalScores.length === 0) {
                    leaderboardList.innerHTML = `
                        <div class="score-entry">
                            <span>ğŸŒ MÃ©g nincsenek globÃ¡lis eredmÃ©nyek</span>
                        </div>
                    `;
                } else {
                    leaderboardList.innerHTML = globalScores.map((score, index) => {
                        // DÃ¡tum formÃ¡zÃ¡sa
                        let dateText = 'Ma';
                        if (score.timestamp && score.timestamp.seconds) {
                            const date = new Date(score.timestamp.seconds * 1000);
                            dateText = date.toLocaleDateString('hu-HU');
                        } else if (score.date) {
                            dateText = score.date;
                        }
                        
                        // Thumbnail kezelÃ©se
                        const thumbnailHTML = score.thumbnail ? 
                            `<div class="thumbnail-container">
                                <img src="${score.thumbnail}" 
                                     class="leaderboard-thumbnail" 
                                     style="width: 40px; height: 40px; object-fit: cover; border-radius: 6px; cursor: pointer;" 
                                     onclick="window.ThumbnailGenerator.showThumbnailModal('${score.thumbnail}')"
                                     title="Kattints a nagyÃ­tÃ¡shoz">
                            </div>` : 
                            `<div class="thumbnail-container">
                                <div class="no-thumbnail" style="width: 40px; height: 40px; background: linear-gradient(45deg, #f0f0f0, #e0e0e0); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #999;">ğŸŒ</div>
                            </div>`;
                        
                        return `
                            <div class="leaderboard-entry global-entry" data-score-id="${score.id}">
                                ${thumbnailHTML}
                                <div class="entry-content">
                                    <div class="entry-main">
                                        <span class="rank" style="font-weight: bold; color: #666; min-width: 30px;">#${index + 1}</span>
                                        <span class="name" style="font-weight: 500; color: #333; margin-right: 8px;">${score.playerName || 'NÃ©vtelen'}</span>
                                        <span class="score" style="font-weight: bold; color: #4CAF50; margin-left: auto;">${score.score} pont</span>
                                    </div>
                                    <div class="entry-details">
                                        <span style="color: #888;">ğŸŒ ${dateText}</span>
                                        ${score.transformation ? ` â€¢ <span style="color: #666;">ğŸ¨ ${score.transformation}</span>` : ''}
                                        ${score.difficulty && score.difficulty !== 'easy' ? ` â€¢ <span style="color: #ff9800;">ğŸŒ€ ${score.difficulty}</span>` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
            } catch (error) {
                console.error('âŒ GlobÃ¡lis leaderboard betÃ¶ltÃ©si hiba:', error);
                
                // âœ… ELLENÅRIZZÃœK HOGY MÃ‰G MINDIG GLOBÃLIS MÃ“DBAN VAGYUNK
                if (window.currentLeaderboardType !== 'global') {
                    console.log('âš ï¸ MÃ¡r nem globÃ¡lis mÃ³dban vagyunk, hiba megjelenÃ­tÃ©s kihagyva...');
                    return;
                }
                
                // Hiba megjelenÃ­tÃ©se
                leaderboardList.innerHTML = `
                    <div class="score-entry" style="color: #f44336;">
                        <span>âŒ Hiba a globÃ¡lis eredmÃ©nyek betÃ¶ltÃ©sekor</span>
                        <div style="font-size: 12px; margin-top: 5px; color: #666;">
                            ${error.message}
                        </div>
                    </div>
                `;
                
                if (leaderboardStatus) {
                    leaderboardStatus.textContent = 'âŒ GlobÃ¡lis eredmÃ©nyek nem elÃ©rhetÅ‘k';
                }
            }
        };

        // Firebase score mentÃ©s globÃ¡lisan
// A showScore fÃ¼ggvÃ©nyben (mÃ¡r van, de ellenÅ‘rizzÃ¼k):
// âœ… JAVÃTOTT - csak Ã¡tadja az adatot, nem kÃ©szÃ­t Ãºj thumbnail-t
window.saveScoreToFirebase = async function(scoreData) {
    try {
        if (!window.firebaseAPI || !window.firebaseAPI.isReady()) {
            console.log('âš ï¸ Firebase nem elÃ©rhetÅ‘, score nem mentve globÃ¡lisan');
            return null;
        }
        
        console.log('ğŸ“¤ Firebase mentÃ©s indÃ­tÃ¡sa:', {
            playerName: scoreData.playerName,
            score: scoreData.score,
            hasThumbnail: !!scoreData.thumbnail,
            thumbnailSize: scoreData.thumbnail ? Math.round(scoreData.thumbnail.length / 1024) + 'KB' : 'nincs'
        });
        
        const result = await window.firebaseAPI.saveScore(scoreData);
        console.log('âœ… Score mentve Firebase-be:', result?.id);
        return result;
        
    } catch (error) {
        console.error('âŒ Firebase score mentÃ©si hiba:', error);
        return null;
    }
};


    </script>

    <!-- InicializÃ¡lÃ¡s -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸŒ DOM betÃ¶ltve, i18n inicializÃ¡lÃ¡s...');
            
            if (window.languageData && window.languageData.hu) {
                window.simpleTranslate = function(key, params = {}) {
                    const keys = key.split('.');
                    let value = window.languageData.hu;
                    
                    for (const k of keys) {
                        if (value && typeof value === 'object' && value[k] !== undefined) {
                            value = value[k];
                        } else {
                            return key;
                        }
                    }
                    
                    if (typeof value === 'string' && params) {
                        Object.keys(params).forEach(param => {
                            value = value.replace(`{${param}}`, params[param]);
                        });
                    }
                    
                    return value;
                };
                
                document.querySelectorAll('[data-i18n]').forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    const translation = window.simpleTranslate(key);
                    
                    if (translation && translation !== key) {
                        if (element.tagName === 'INPUT' && element.type === 'text') {
                            element.placeholder = translation;
                        } else {
                            element.innerHTML = translation;
                        }
                    }
                });
                
                console.log('âœ… EgyszerÅ±sÃ­tett i18n inicializÃ¡lva');
            }
        });
    </script>

    <!-- âœ… JAVÃTOTT LEADERBOARD FÃœGGVÃ‰NYEK -->
    <script>
        // âœ… AUTOMATIKUS LEADERBOARD FRISSÃTÅ THUMBNAILOKKAL - VÃ‰DETT VERZIÃ“
        window.refreshLeaderboard = function() {
            try {
                // âœ… ELLENÅRIZZÃœK A LEADERBOARD TÃPUST
                if (window.currentLeaderboardType === 'global') {
                    console.log('ğŸ›¡ï¸ VÃ‰DELEM: refreshLeaderboard blokkolva globÃ¡lis mÃ³dban');
                    return;
                }
                
                const leaderboardList = document.getElementById('leaderboardList');
                const leaderboardStatus = document.getElementById('leaderboardStatus');
                
                if (!leaderboardList || !window.ScoreManager) return;
                
                const scores = window.ScoreManager.getScores();
                
                // Status frissÃ­tÃ©s
                if (leaderboardStatus) {
                    leaderboardStatus.textContent = `ğŸ“± ${scores.length} helyi eredmÃ©ny`;
                }
                
                // Lista frissÃ­tÃ©s
                if (scores.length === 0) {
                    leaderboardList.innerHTML = `
                        <div class="score-entry">
                            <span>MÃ©g nincsenek eredmÃ©nyek</span>
                        </div>
                    `;
                } else {
                    leaderboardList.innerHTML = scores.map((score, index) => {
                        const thumbnailHTML = score.thumbnail ? 
                            `<div class="thumbnail-container">
                                <img src="${score.thumbnail}" 
                                     class="leaderboard-thumbnail" 
                                     style="width: 40px; height: 40px; object-fit: cover; border-radius: 6px; cursor: pointer;" 
                                     onclick="window.ThumbnailGenerator.showThumbnailModal('${score.thumbnail}')"
                                     title="Kattints a nagyÃ­tÃ¡shoz">
                            </div>` : 
                            `<div class="thumbnail-container">
                                <div class="no-thumbnail" style="width: 40px; height: 40px; background: linear-gradient(45deg, #f0f0f0, #e0e0e0); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #999;">ğŸ¨</div>
                            </div>`;
                        
                        return `
                            <div class="leaderboard-entry local-entry" data-score-id="${score.id}">
                                ${thumbnailHTML}
                                <div class="entry-content">
                                    <div class="entry-main">
                                        <span class="rank" style="font-weight: bold; color: #666; min-width: 30px;">#${index + 1}</span>
                                        <span class="name" style="font-weight: 500; color: #333; margin-right: 8px;">${score.playerName || 'NÃ©vtelen'}</span>
                                        <span class="score" style="font-weight: bold; color: #4CAF50; margin-left: auto;">${score.score} pont</span>
                                    </div>
                                    <div class="entry-details">
                                        <span style="color: #888;">${score.date || 'Ma'}</span>
                                        ${score.transformation ? ` â€¢ <span style="color: #666;">ğŸ¨ ${score.transformation}</span>` : ''}
                                        ${score.difficulty && score.difficulty !== 'easy' ? ` â€¢ <span style="color: #ff9800;">ğŸŒ€ ${score.difficulty}</span>` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                console.log(`âœ… Leaderboard frissÃ­tve thumbnailokkal: ${scores.length} eredmÃ©ny`);
                
            } catch (error) {
                console.error('âŒ Leaderboard frissÃ­tÃ©si hiba:', error);
            }
        };

        // âœ… FELTÃ‰TELES AUTOMATIKUS FRISSÃTÃ‰S
        let refreshInterval = null;
        
        function startLocalRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            refreshInterval = setInterval(() => {
                if (window.currentLeaderboardType === 'local') {
                    window.refreshLeaderboard();
                }
            }, 3000); // 3 mÃ¡sodpercenkÃ©nt
            console.log('âœ… Helyi leaderboard automatikus frissÃ­tÅ‘ elindÃ­tva');
        }
        
        function stopLocalRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
                console.log('ğŸ›‘ Helyi leaderboard automatikus frissÃ­tÅ‘ leÃ¡llÃ­tva');
            }
        }

        // âœ… JAVÃTOTT SWITCHLEADERBOARD FÃœGGVÃ‰NY
        window.switchLeaderboard = function(type) {
            console.log('ğŸ”„ HTML switchLeaderboard hÃ­vÃ¡s:', type);
            
            // âœ… AZONNAL BEÃLLÃTJUK A TÃPUST
            window.currentLeaderboardType = type;
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            const targetTab = document.getElementById(type + 'Tab');
            if (targetTab) targetTab.classList.add('active');
            
            const listContainer = document.getElementById('leaderboardList');
            const statusContainer = document.getElementById('leaderboardStatus');
            
            if (statusContainer) {
                statusContainer.textContent = type === 'local' ? 'ğŸ“± Helyi eredmÃ©nyek' : 'ğŸŒ GlobÃ¡lis eredmÃ©nyek';
            }
            
            if (listContainer) {
                if (type === 'local') {
                    startLocalRefresh(); // Helyi frissÃ­tÅ‘ bekapcsolÃ¡sa
                    window.refreshLeaderboard();
                } else {
                    stopLocalRefresh(); // Helyi frissÃ­tÅ‘ kikapcsolÃ¡sa
                    window.loadGlobalLeaderboard();
                }
            }
        };

        // IndÃ­tÃ¡s
        setTimeout(startLocalRefresh, 2000);
    </script>

    <!-- SHOWSCORE FELÃœLÃRÃSA FIREBASE MENTÃ‰SSEL -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                console.log('ğŸ”„ showScore felÃ¼lÃ­rÃ¡sa Firebase tÃ¡mogatÃ¡ssal...');
                
                // ÃšJ showScore fÃ¼ggvÃ©ny Firebase mentÃ©ssel
                window.showScore = async function(score, analysis, transformationName = '') {
                    console.log('ğŸ† ÃšJ showScore hÃ­vva Firebase mentÃ©ssel:', { score, analysis, transformationName });
                    
                    try {
                        // Score validÃ¡lÃ¡s
                        const roundedScore = Math.round(Number(score));
                        if (isNaN(roundedScore)) {
                            console.error('âŒ Ã‰rvÃ©nytelen score:', score);
                            return;
                        }
                        
                        // SCORE ANIMÃCIÃ“ INDÃTÃSA
                        if (window.ScoreAnimator) {
                            window.ScoreAnimator.animateScore(roundedScore, analysis, transformationName);
                            window.ScoreAnimator.vibrate(roundedScore);
                        }
                        
                        // UI elemek frissÃ­tÃ©se
                        setTimeout(() => {
                            const elements = {
                                scoreDisplay: document.getElementById('scoreDisplay'),
                                finalScore: document.getElementById('finalScore'),
                                currentScore: document.getElementById('currentScore'),
                                scoreBreakdown: document.getElementById('scoreBreakdown')
                            };
                            
                            if (elements.finalScore) elements.finalScore.textContent = roundedScore;
                            if (elements.currentScore) elements.currentScore.textContent = roundedScore;
                            
                            if (elements.scoreBreakdown && analysis) {
                                let breakdownHTML = '';
                                if (analysis.shape !== undefined) breakdownHTML += `<div>ğŸ”µ KÃ¶ralak: ${Math.round(analysis.shape)}/40</div>`;
                                if (analysis.closure !== undefined) breakdownHTML += `<div>ğŸ”— ZÃ¡rÃ³dÃ¡s: ${Math.round(analysis.closure)}/20</div>`;
                                if (analysis.smoothness !== undefined) breakdownHTML += `<div>ğŸŒŠ EgyenletessÃ©g: ${Math.round(analysis.smoothness)}/25</div>`;
                                if (analysis.size !== undefined) breakdownHTML += `<div>ğŸ“ MÃ©ret: ${Math.round(analysis.size)}/15</div>`;
                                elements.scoreBreakdown.innerHTML = breakdownHTML;
                            }
                            
                            if (elements.scoreDisplay) {
                                elements.scoreDisplay.style.display = 'block';
                                elements.scoreDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }
                        }, 2500);
                        
                        // THUMBNAIL KÃ‰SZÃTÃ‰SE Ã‰S MENTÃ‰S
                        if (roundedScore > 0 && window.ScoreManager && window.ThumbnailGenerator) {
                            console.log('ğŸ’¾ Score mentÃ©se thumbnaillal Ã©s Firebase-be...');
                            
                            const thumbnail = await window.ThumbnailGenerator.captureTransformationThumbnail(1000);
                            const difficulty = window.gameEngine?.getDifficulty() || 'easy';
                            const playerName = document.getElementById('playerName')?.value?.trim() || 'NÃ©vtelen';
                            
                            // Helyi mentÃ©s
                            let savedScore;
                            if (window.ScoreManager.saveScore.length >= 5) {
                                savedScore = window.ScoreManager.saveScore(
                                    roundedScore,
                                    analysis,
                                    difficulty,
                                    transformationName,
                                    thumbnail
                                );
                            } else {
                                savedScore = window.ScoreManager.saveScore(
                                    roundedScore,
                                    analysis,
                                    difficulty,
                                    transformationName
                                );
                                
                                if (thumbnail && savedScore && savedScore.id) {
                                    const scores = window.ScoreManager.getScores();
                                    const scoreIndex = scores.findIndex(s => s.id === savedScore.id);
                                    if (scoreIndex !== -1) {
                                        scores[scoreIndex].thumbnail = thumbnail;
                                        localStorage.setItem('perfectcircle_scores', JSON.stringify(scores));
                                    }
                                }
                            }
                            
                            // Firebase mentÃ©s
                            const firebaseData = {
                                playerName: playerName,
                                score: roundedScore,
                                difficulty: difficulty,
                                transformation: transformationName,
                                thumbnail: thumbnail
                            };
                            
                            const firebaseResult = await window.saveScoreToFirebase(firebaseData);
                            if (firebaseResult) {
                                console.log('âœ… Score mentve Firebase-be is:', firebaseResult);
                            }
                            
                            console.log('âœ… Score mentve thumbnaillal:', savedScore);
                            
                            // Thumbnail megjelenÃ­tÃ©se
                            setTimeout(() => {
                                const scoreDisplay = document.getElementById('scoreDisplay');
                                if (thumbnail && scoreDisplay) {
                                    window.ThumbnailGenerator.displayThumbnail(thumbnail, 'scoreDisplay', 'current-score-thumbnail');
                                }
                            }, 3000);
                            
                            // âœ… LEADERBOARD FRISSÃTÃ‰SE - CSAK HELYI MÃ“DBAN
                            setTimeout(() => {
                                if (window.currentLeaderboardType === 'local') {
                                    window.refreshLeaderboard();
                                    console.log('ğŸ”„ Helyi leaderboard frissÃ­tve showScore utÃ¡n');
                                } else {
                                    console.log('ğŸŒ GlobÃ¡lis mÃ³dban vagyunk, helyi leaderboard frissÃ­tÃ©s kihagyva');
                                }
                            }, 100);
                            
                            // StatisztikÃ¡k frissÃ­tÃ©se
                            setTimeout(() => {
                                if (window.updateStats) {
                                    window.updateStats();
                                }
                            }, 200);
                        }
                        
                    } catch (error) {
                        console.error('âŒ showScore hiba:', error);
                    }
                };
                
                console.log('âœ… showScore sikeresen felÃ¼lÃ­rva Firebase tÃ¡mogatÃ¡ssal');
                
            }, 1000);
        });
    </script>

    <!-- âœ… VISITOR COUNTER INICIALIZÃLÃS -->
    <script>
        // âœ… VISITOR COUNTER INICIALIZÃLÃS - JAVÃTOTT VERZIÃ“
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”„ VisitorCounter inicializÃ¡lÃ¡s indÃ­tÃ¡sa...');
            
            // VÃ¡rjunk egy kicsit, hogy minden script betÃ¶ltÅ‘djÃ¶n
            setTimeout(() => {
                initVisitorCounterWithRetry();
            }, 2000);
        });
        
        function initVisitorCounterWithRetry() {
            let attempts = 0;
            const maxAttempts = 20; // CsÃ¶kkentve
            
            const tryInit = () => {
                attempts++;
                console.log(`ğŸ”„ VisitorCounter kÃ­sÃ©rlet ${attempts}/${maxAttempts}...`);
                
                // EllenÅ‘rizzÃ¼k hogy lÃ©tezik-e a VisitorCounter
                if (window.VisitorCounter) {
                    console.log('âœ… VisitorCounter megtalÃ¡lva!');
                    console.log('- TÃ­pus:', typeof window.VisitorCounter);
                    console.log('- Init metÃ³dus:', typeof window.VisitorCounter.init);
                    
                    if (typeof window.VisitorCounter.init === 'function') {
                        console.log('ğŸš€ VisitorCounter.init() hÃ­vÃ¡sa...');
                        
                        window.VisitorCounter.init()
                            .then(() => {
                                console.log('âœ… VisitorCounter sikeresen inicializÃ¡lva!');
                            })
                            .catch(error => {
                                console.error('âŒ VisitorCounter init hiba:', error);
                                startFallbackCounter();
                            });
                        return;
                    } else {
                        console.error('âŒ VisitorCounter.init nem fÃ¼ggvÃ©ny!');
                    }
                }
                
                // Ha mÃ©g nem Ã©rhetÅ‘ el Ã©s van mÃ©g kÃ­sÃ©rlet
                if (attempts < maxAttempts) {
                    setTimeout(tryInit, 200);
                } else {
                    console.warn('âš ï¸ VisitorCounter nem talÃ¡lhatÃ³, fallback indÃ­tÃ¡sa...');
                    startFallbackCounter();
                }
            };
            
            tryInit();
        }
        
        function startFallbackCounter() {
            console.log('ğŸ”„ Fallback visitor counter indÃ­tÃ¡sa...');
            
            try {
                let visits = parseInt(localStorage.getItem('perfectcircle_visits') || '0');
                visits++;
                localStorage.setItem('perfectcircle_visits', visits.toString());
                localStorage.setItem('perfectcircle_last_visit', new Date().toISOString());
                
                if (!localStorage.getItem('perfectcircle_first_visit')) {
                    localStorage.setItem('perfectcircle_first_visit', new Date().toISOString());
                }
                
                const visitCountElement = document.getElementById('visitCount');
                if (visitCountElement) {
                    visitCountElement.textContent = visits;
                    console.log('âœ… Visitor count frissÃ­tve DOM-ban:', visits);
                } else {
                    console.error('âŒ visitCount elem nem talÃ¡lhatÃ³!');
                }
                
                console.log('ğŸ‘¥ Fallback lÃ¡togatÃ¡sszÃ¡mlÃ¡lÃ³ inicializÃ¡lva:', visits);
                
            } catch (error) {
                console.error('âŒ Fallback counter hiba:', error);
            }
        }
    </script>

    <!-- EGYÃ‰B SEGÃ‰DFÃœGGVÃ‰NYEK -->
    <script>
        window.updateStats = function() {
            console.log('ğŸ“Š updateStats called');
            
            if (window.ScoreManager) {
                const stats = window.ScoreManager.getStats();
                
                const currentScore = document.getElementById('currentScore');
                const bestScore = document.getElementById('bestScore');
                const gamesPlayed = document.getElementById('gamesPlayed');
                const averageScore = document.getElementById('averageScore');
                
                if (currentScore) currentScore.textContent = stats.currentScore || 0;
                if (bestScore) bestScore.textContent = stats.best || 0;
                if (gamesPlayed) gamesPlayed.textContent = stats.games || 0;
                if (averageScore) averageScore.textContent = Math.round(stats.average) || 0;
                
                console.log('âœ… StatisztikÃ¡k frissÃ­tve:', stats);
            } else {
                console.log('âš ï¸ ScoreManager nem elÃ©rhetÅ‘');
            }
        };

        window.showVisitStats = function() {
            console.log('ğŸ“Š LÃ¡togatÃ¡si statisztikÃ¡k lekÃ©rÃ©se...');
            
            if (window.VisitorCounter && typeof window.VisitorCounter.showStats === 'function') {
                // Firebase-alapÃº statisztikÃ¡k
                window.VisitorCounter.showStats();
            } else {
                // Fallback helyi statisztikÃ¡k
                const visitCount = localStorage.getItem('perfectcircle_visits') || 0;
                const firstVisit = localStorage.getItem('perfectcircle_first_visit');
                const lastVisit = localStorage.getItem('perfectcircle_last_visit');
                
                let message = `ğŸ‘¥ Helyi lÃ¡togatÃ¡si statisztikÃ¡k:\n\n`;
                message += `ğŸ”¢ Helyi lÃ¡togatÃ¡sok: ${visitCount}\n`;
                
                if (firstVisit) {
                    const firstDate = new Date(firstVisit);
                    message += `ğŸ†• ElsÅ‘ helyi lÃ¡togatÃ¡s: ${firstDate.toLocaleDateString('hu-HU')}\n`;
                }
                
                if (lastVisit) {
                    const lastDate = new Date(lastVisit);
                    message += `ğŸ• UtolsÃ³ lÃ¡togatÃ¡s: ${lastDate.toLocaleDateString('hu-HU')} ${lastDate.toLocaleTimeString('hu-HU')}\n\n`;
                }
                
                message += `âš ï¸ Firebase lÃ¡togatÃ¡sszÃ¡mlÃ¡lÃ³ nem elÃ©rhetÅ‘.`;
                
                alert(message);
            }
        };

        window.setDifficulty = function(level) {
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.querySelector(`[data-difficulty="${level}"]`);
            if (activeBtn) activeBtn.classList.add('active');
            
            localStorage.setItem('perfectcircle_difficulty', level);
            
            if (window.gameEngine && window.gameEngine.setDifficulty) {
                window.gameEngine.setDifficulty(level);
            }
            
            console.log(`âœ… NehÃ©zsÃ©g beÃ¡llÃ­tva: ${level}`);
        };
    </script>

    <!-- âœ… VISITOR COUNTER DEBUG -->
    <script>
        // âœ… VISITOR COUNTER DEBUG
        window.debugVisitorCounter = function() {
            console.log('ğŸ” === VISITOR COUNTER DEBUG ===');
            console.log('- window.VisitorCounter:', !!window.VisitorCounter);
            console.log('- VisitorCounter tÃ­pusa:', typeof window.VisitorCounter);
            console.log('- VisitorCounter.init:', typeof window.VisitorCounter?.init);
            
            if (window.VisitorCounter) {
                console.log('- VisitorCounter metÃ³dusok:', Object.getOwnPropertyNames(window.VisitorCounter));
            }
            
            // Script fÃ¡jlok ellenÅ‘rzÃ©se
            const scripts = Array.from(document.querySelectorAll('script[src]'));
            const visitorScript = scripts.find(s => s.src.includes('visitorCounter'));
            console.log('- VisitorCounter script betÃ¶ltve:', !!visitorScript);
            
            if (visitorScript) {
                console.log('- Script src:', visitorScript.src);
                console.log('- Script loaded:', !visitorScript.hasAttribute('async') || visitorScript.readyState === 'complete');
            }
            
            // Helyi adatok
            const localVisits = localStorage.getItem('perfectcircle_visits');
            console.log('- Helyi lÃ¡togatÃ¡sok:', localVisits);
            
            // DOM elem
            const visitElement = document.getElementById('visitCount');
            console.log('- Visit count elem:', !!visitElement);
            console.log('- Jelenlegi Ã©rtÃ©k:', visitElement?.textContent);
            
            console.log('=== DEBUG VÃ‰GE ===');
        };
        
        // Automatikus debug 3 mÃ¡sodperc utÃ¡n
        setTimeout(() => {
            console.log('ğŸ” Automatikus VisitorCounter debug...');
            window.debugVisitorCounter();
        }, 3000);
    </script>

    <!-- EMERGENCY BUTTON HANDLERS -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”§ Emergency button handlers loading...');
            
            // Leaderboard tabok
            const localTab = document.getElementById('localTab');
            const globalTab = document.getElementById('globalTab');
            
            if (localTab) {
                localTab.addEventListener('click', function() {
                    console.log('Local tab clicked');
                    window.switchLeaderboard('local');
                });
            }
            
            if (globalTab) {
                globalTab.addEventListener('click', function() {
                    console.log('Global tab clicked');
                    window.switchLeaderboard('global');
                });
            }
            
            // Start gomb
            const startBtn = document.getElementById('startBtn');
            if (startBtn) {
                startBtn.addEventListener('click', function() {
                    console.log('Start button clicked');
                    if (window.gameEngine && typeof window.gameEngine.startDrawing === 'function') {
                        window.gameEngine.startDrawing();
                    } else {
                        console.log('GameEngine not ready');
                    }
                });
            }
            
            // Clear gomb
            const clearBtn = document.getElementById('clearBtn');
            if (clearBtn) {
                clearBtn.addEventListener('click', function() {
                    console.log('Clear button clicked');
                    if (window.gameEngine && typeof window.gameEngine.clearCanvas === 'function') {
                        window.gameEngine.clearCanvas();
                    } else {
                        console.log('GameEngine not ready');
                    }
                });
            }
            
            // Help gomb
            const helpBtn = document.getElementById('helpBtn');
            if (helpBtn) {
                helpBtn.addEventListener('click', function() {
                    console.log('Help button clicked');
                    alert('ğŸ¯ PERFECT CIRCLE\n\nRajzolj tÃ¶kÃ©letes kÃ¶rt egyetlen mozdulattal!\n\nğŸ® IrÃ¡nyÃ­tÃ¡s:\nâ€¢ EgÃ©r: Kattints Ã©s hÃºzd\nâ€¢ Mobil: Ã‰rintsd Ã©s hÃºzd\n\nğŸ† PontszÃ¡mÃ­tÃ¡s:\nâ€¢ KÃ¶ralak (40p)\nâ€¢ ZÃ¡rÃ³dÃ¡s (20p)\nâ€¢ EgyenletessÃ©g (25p)\nâ€¢ MÃ©ret (15p)\n\nSok sikert! ğŸ€');
                });
            }
            
            // Save Name gomb
            const saveNameBtn = document.getElementById('saveNameBtn');
            if (saveNameBtn) {
                saveNameBtn.addEventListener('click', function() {
                    console.log('Save name button clicked');
                    const input = document.getElementById('playerName');
                    const name = input ? input.value.trim() : '';
                    if (name) {
                        localStorage.setItem('perfectcircle_playername', name);
                        alert('NÃ©v mentve: ' + name + ' âœ…');
                    } else {
                        alert('KÃ©rlek add meg a neved! âŒ');
                    }
                });
            }
            
            // Clear Scores gomb
            const clearScoresBtn = document.getElementById('clearScoresBtn');
            if (clearScoresBtn) {
                clearScoresBtn.addEventListener('click', function() {
                    console.log('Clear scores button clicked');
                    if (confirm('Biztosan tÃ¶rÃ¶lni szeretnÃ©d az Ã¶sszes helyi eredmÃ©nyt?')) {
                        if (window.ScoreManager && window.ScoreManager.clearScores) {
                            window.ScoreManager.clearScores();
                            alert('Helyi eredmÃ©nyek tÃ¶rÃ¶lve! âœ…');
                            
                            // StatisztikÃ¡k frissÃ­tÃ©se
                            if (window.updateStats) {
                                window.updateStats();
                            }
                            
                            // Leaderboard frissÃ­tÃ©se
                            if (window.currentLeaderboardType === 'local') {
                                window.refreshLeaderboard();
                            }
                        } else {
                            alert('ScoreManager nem elÃ©rhetÅ‘! âŒ');
                        }
                    }
                });
            }
            
            console.log('âœ… Emergency button handlers loaded');
        });

        // Emergency global functions
        window.startDrawing = function() {
            console.log('Global startDrawing called');
            if (window.gameEngine && window.gameEngine.startDrawing) {
                window.gameEngine.startDrawing();
            } else {
                console.log('GameEngine not ready for startDrawing');
            }
        };

        window.clearCanvas = function() {
            console.log('Global clearCanvas called');
            if (window.gameEngine && window.gameEngine.clearCanvas) {
                window.gameEngine.clearCanvas();
            } else {
                console.log('GameEngine not ready for clearCanvas');
            }
        };

        window.showInstructions = function() {
            console.log('Global showInstructions called');
            alert('ğŸ¯ PERFECT CIRCLE\n\nRajzolj tÃ¶kÃ©letes kÃ¶rt egyetlen mozdulattal!');
        };

        window.savePlayerName = function() {
            console.log('Global savePlayerName called');
            const input = document.getElementById('playerName');
            const name = input ? input.value.trim() : '';
            if (name) {
                localStorage.setItem('perfectcircle_playername', name);
                alert('NÃ©v mentve: ' + name);
                return true;
            } else {
                alert('Add meg a neved!');
                return false;
            }
        };

        window.clearAllScores = function() {
            console.log('Global clearAllScores called');
            if (confirm('Biztosan tÃ¶rÃ¶lni szeretnÃ©d az Ã¶sszes helyi eredmÃ©nyt?')) {
                if (window.ScoreManager && window.ScoreManager.clearScores) {
                    window.ScoreManager.clearScores();
                    alert('Helyi eredmÃ©nyek tÃ¶rÃ¶lve!');
                    if (window.currentLeaderboardType === 'local') {
                        window.refreshLeaderboard();
                    }
                } else {
                    alert('ScoreManager nem elÃ©rhetÅ‘!');
                }
            }
        };
    </script>

</body>
</html>
