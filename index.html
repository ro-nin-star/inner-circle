<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title">Perfect Circle - Rajzolj T√∂k√©letes K√∂rt!</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- ‚úÖ GLOB√ÅLIS LEADERBOARD T√çPUS K√ñVET√âSE - HTML SZINTEN -->
    <script>
        window.currentLeaderboardType = 'local';
        console.log('üîß HTML szint≈± leaderboard t√≠pus be√°ll√≠tva:', window.currentLeaderboardType);
    </script>
    <link rel="icon" type="image/x-icon" href="favicon.ico">

</head>

<body>

<!-- J√ÅT√âKM√ìD V√ÅLASZT√ì MODAL -->
<div id="gameModeModal" class="game-mode-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üéØ V√°lassz J√°t√©km√≥dot!</h2>
            <p>Melyik kih√≠v√°st szeretn√©d kipr√≥b√°lni?</p>
        </div>
        
        <div class="mode-selection">
            <div class="mode-card" onclick="selectGameMode('circle')">
                <div class="mode-icon">üéØ</div>
                <h3>Verseny M√≥d</h3>
                <p>Rajzolj t√∂k√©letes k√∂r√∂ket √©s versenyezz m√°sokkal!</p>
                <ul>
                    <li>‚ú® K√∂rrajzol√°s kih√≠v√°s</li>
                    <li>üèÜ Glob√°lis ranglista</li>
                    <li>üé® Var√°zslatos transzform√°ci√≥k</li>
                    <li>‚ö° Gyors j√°t√©kmenet</li>
                </ul>
                <button class="mode-select-btn">Verseny Ind√≠t√°sa</button>
            </div>
            
            <div class="mode-card" onclick="selectGameMode('drawing')">
                <div class="mode-icon">üé®</div>
                <h3>Rajz M√≥d</h3>
                <p>K√∂vesd le k√ºl√∂nb√∂z≈ë alakzatokat id≈ëre!</p>
                <ul>
                    <li>üìê K√ºl√∂nb√∂z≈ë alakzatok</li>
                    <li>‚è±Ô∏è Id≈ëm√©r√©s</li>
                    <li>üéØ Progressz√≠v neh√©zs√©g</li>
                    <li>üèÖ Teljes√≠tm√©ny k√∂vet√©s</li>
                </ul>
                <button class="mode-select-btn">Rajz Kezd√©se</button>
            </div>
        </div>
        
        <div class="modal-footer">
            <p><small>üí° B√°rmikor v√°lthat a m√≥dok k√∂z√∂tt a be√°ll√≠t√°sokban</small></p>
        </div>
    </div>
</div>


    <!-- J√°t√©kos anim√°lt h√°tt√©r elemek -->
    <div class="decoration-circle"></div>
    <div class="decoration-circle"></div>
    <div class="decoration-circle"></div>

    <!-- ===== J√ÅT√âKOS FELS≈ê FIX FEJL√âC ===== -->
    <div class="top-fixed-header">
        <!-- Firebase Status -->
        <div class="firebase-status connecting" id="firebaseStatus" data-i18n="firebase.connecting">üü° Kapcsol√≥d√°s...</div>
        <!-- Nyelv v√°lt√≥ -->
        <div class="language-selector" id="languageSelector">
            <div class="current-language" onclick="window.i18nManager?.toggleLanguageMenu()">
                <span id="currentLanguageFlag">üá≠üá∫</span>
                <span id="currentLanguageCode">HU</span>
            </div>
            <div class="language-menu" id="languageMenu">
                <!-- Dinamikusan t√∂lt≈ëdik a JavaScript √°ltal -->
            </div>
        </div>
    </div>
    <!-- ==================================================== -->

    <div class="game-container" id="gameContainer">
        <h1 data-i18n="title">üéØ Perfect Circle</h1>
        <p class="subtitle" data-i18n="subtitle">Rajzolj a lehet≈ë legt√∂k√©letesebb k√∂rt egyetlen mozdulattal!</p>
        
        <div class="instructions">
            <strong data-i18n="instructions.title">üéÆ Hogyan j√°tssz:</strong> 
            <span data-i18n="instructions.text">Kattints √©s h√∫zd az egeret (vagy √©rintsd √©s h√∫zd az ujjad) hogy egy k√∂rt rajzolj. Min√©l t√∂k√©letesebb a k√∂r√∂d, ann√°l t√∂bb pontot kapsz! A k√∂r var√°zslatos m√≥don √°t fog v√°ltozni! ‚ú®</span>
        </div>

        <!-- Offline notice -->
        <div class="offline-notice" id="offlineNotice" style="display: none;">
            <span data-i18n="firebase.offlineNotice">‚ö†Ô∏è <strong>Offline m√≥d:</strong> A glob√°lis ranglista nem el√©rhet≈ë. Az eredm√©nyek helyben ment≈ëdnek.</span>
        </div>

        <!-- PLAYER NAME SECTION √âS NEH√âZS√âG V√ÅLASZT√ì EGY SORBAN -->
        <div class="player-difficulty-row">
            <div class="player-name-section">
                <label for="playerName"><strong data-i18n="player.label">N√©v:</strong></label>
                <input type="text" id="playerName" class="player-name-input" data-i18n="player.placeholder" placeholder="Add meg a neved" maxlength="20" value="">
                <button id="saveNameBtn" data-i18n="buttons.save">üíæ Ment√©s</button>
            </div>

            <div class="difficulty-selector">
                <strong data-i18n="difficulty.label">üéØ Neh√©zs√©g:</strong><br>
                <button class="difficulty-btn active" onclick="setDifficulty('easy')" data-difficulty="easy" data-i18n="difficulty.easy">K√∂nny≈± üòä</button>
                <button class="difficulty-btn" onclick="setDifficulty('hard')" data-difficulty="hard" data-i18n="difficulty.hard">Neh√©z üåÄ</button>
            </div>
        </div>
<!-- üéØ RAJZOL√ÅS GOMB - FEL√úL -->

<!-- ‚úÖ JAV√çTOTT STATISZTIK√ÅK HTML -->
<div class="stats-container">
    <div class="stat-item">
        <div class="stat-label">Jelenlegi</div>
        <div class="stat-value" id="currentScore">0</div>
    </div>
    <div class="stat-item">
        <div class="stat-label">Legjobb</div>
        <div class="stat-value" id="bestScore">0</div>
    </div>
    <div class="stat-item">
        <div class="stat-label">J√°t√©kok</div>
        <div class="stat-value" id="gamesPlayed">0</div>
    </div>
    <div class="stat-item">
        <div class="stat-label">√Åtlag</div>
        <div class="stat-value" id="averageScore">0</div>
    </div>
</div>


        <!-- ‚úÖ N√âGYZETES CANVAS CONTAINER -->
        <div class="canvas-container">
            <canvas id="gameCanvas" width="460" height="460"></canvas>
            <canvas id="idealCircleCanvas" width="460" height="460"></canvas>
            <div class="canvas-overlay" id="canvasOverlay"></div>
            <div class="transformation-overlay" id="transformationOverlay">
                <div class="transformation-content">
                    <h2 id="transformationText" data-i18n="transformation.magic">‚ú® Var√°zslat t√∂rt√©nik... ‚ú®</h2>
                </div>
            </div>
        </div>

        <div class="controls">
            <button id="startBtn" data-i18n="buttons.startDrawing" >üéØ Rajzol√°s Kezd√©se</button>
            <button id="clearBtn" disabled data-i18n="buttons.clear">üóëÔ∏è T√∂rl√©s</button>
            <button id="helpBtn" data-i18n="buttons.help">‚ùì Seg√≠ts√©g</button>
            <button id="clearScoresBtn" data-i18n="buttons.clearScores">üóëÔ∏è Helyi Eredm√©nyek T√∂rl√©se</button>
            <button id="guideBtn" onclick="window.toggleCanvasGuide?.()" data-i18n="buttons.guide">üìç Seg√©dvonal</button>
            <button id="switchModeBtn" onclick="window.GameModeManager?.showModeSelector()" data-i18n="buttons.switchMode">üîÑ M√≥d V√°lt√°s</button>

        </div>

        <!-- Pontsz√°m megjelen√≠t≈ë -->
        <div class="score-display" id="scoreDisplay" style="display: none;">
            <h3 id="scoreTitle" data-i18n="scoreTitle.result">üèÜ Eredm√©ny</h3>
            <div class="score-number">
                <span id="finalScore">0</span>/100 <span data-i18n="common.points">pont</span>
            </div>
            <div class="score-breakdown" id="scoreBreakdown">
                <!-- Dinamikusan t√∂lt≈ëdik -->
            </div>
            
            <!-- Ide√°lis k√∂r √∂sszehasonl√≠t√°s -->
            <div id="idealCircleContainer" class="ideal-circle-container" style="display: none;">
                <h4 data-i18n="analysis.idealCircle">Ide√°lis k√∂r √∂sszehasonl√≠t√°s:</h4>
                <div class="ideal-circle-canvas-container">
                    <canvas id="idealComparisonCanvas" width="200" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- LEADERBOARD WITH TABS -->
        <div class="leaderboard">
            <h3 data-i18n="leaderboard.title">üèÜ Ranglista</h3>
            <div class="leaderboard-tabs">
                <button id="localTab" class="tab-btn active">
                    üì± Helyi
                </button>
                <button id="globalTab" class="tab-btn">
                    üåç Glob√°lis
                </button>
            </div>

            <div class="leaderboard-status" id="leaderboardStatus" data-i18n="leaderboard.localResults">
                üì± Helyi eredm√©nyek
            </div>
            <div id="leaderboardList">
                <div class="score-entry">
                    <span data-i18n="leaderboard.noResults">M√©g nincsenek eredm√©nyek</span>
                </div>
            </div>
        </div>

        <!-- R√©szletes instrukci√≥k -->
        <div class="detailed-instructions">
            <h3 data-i18n="instructions.detailedTitle">üìñ R√©szletes √ötmutat√≥</h3>
            <div class="instruction-section">
                <h4 data-i18n="instructions.gameplayTitle">üéÆ J√°t√©kmenet:</h4>
                <ul>
                    <li data-i18n="instructions.step1">Kattints a "Rajzol√°s Kezd√©se" gombra</li>
                    <li data-i18n="instructions.step2">Rajzolj egy k√∂rt egyetlen mozdulattal</li>
                    <li data-i18n="instructions.step3">N√©zd meg az eredm√©nyed √©s a transzform√°ci√≥t!</li>
                </ul>
            </div>
            
            <div class="instruction-section">
                <h4 data-i18n="instructions.scoringTitle">üìä Pontsz√°m√≠t√°s:</h4>
                <ul>
                    <li data-i18n="instructions.shapeScore">üîµ K√∂ralak (40 pont): Mennyire hasonl√≠t k√∂rre</li>
                    <li data-i18n="instructions.closureScore">üîó Z√°r√≥d√°s (20 pont): Mennyire z√°rt a forma</li>
                    <li data-i18n="instructions.smoothnessScore">üåä Egyenletess√©g (25 pont): Mennyire egyenletes a vonal</li>
                    <li data-i18n="instructions.sizeScore">üìè M√©ret (15 pont): Optim√°lis m√©ret haszn√°lata</li>
                </ul>
            </div>
            
            <div class="instruction-section">
                <h4 data-i18n="instructions.transformationsTitle">üé® Transzform√°ci√≥k:</h4>
                <p data-i18n="instructions.transformationsText">70+ pont eset√©n a k√∂r√∂d var√°zslatos alakzatt√° v√°ltozik! Minden transzform√°ci√≥ ut√°n egy mosolyg√≥ arc jelenik meg! üòä</p>
            </div>
            
            <div class="instruction-section">
                <h4 data-i18n="instructions.controlsTitle">‚å®Ô∏è Billenty≈± parancsok:</h4>
                <ul>
                    <li data-i18n="instructions.ctrlS">Ctrl+S: Rajzol√°s kezd√©se</li>
                    <li data-i18n="instructions.ctrlR">Ctrl+R: T√∂rl√©s</li>
                    <li data-i18n="instructions.ctrlH">Ctrl+H: Seg√≠ts√©g</li>
                    <li data-i18n="instructions.ctrlL">Ctrl+L: Nyelv men√º</li>
                    <li data-i18n="instructions.escape">Esc: J√°t√©k megszak√≠t√°sa</li>
                    <li data-i18n="instructions.f1">F1: Seg√≠ts√©g</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- L√°togat√°ssz√°ml√°l√≥ -->
    <div class="visitor-counter" id="visitorCounter" onclick="showVisitStats()">
        <span data-i18n="visitors.label">üë• L√°togat√°sok:</span> <span class="visitor-number" id="visitCount">0</span>
    </div>

    <!-- Fejleszt≈ëi inform√°ci√≥k -->
    <div class="dev-info">
        <span data-i18n="dev.version">v2.1</span> | 
        <span onclick="window.debugGameEngine?.()" data-i18n="dev.debug">Debug</span>
    </div>
<!-- J√ÅT√âKM√ìD KEZEL≈ê -->
<!-- JAV√çTOTT J√ÅT√âKM√ìD KEZEL≈ê -->
<!-- JAV√çTOTT J√ÅT√âKM√ìD KEZEL≈ê - TIMER CSAK RAJZOL√ÅS KEZD√âSEKOR -->
<script>
// INTELLIGENS ALAKZAT FELISMER≈ê J√ÅT√âKM√ìD KEZEL≈ê
window.GameModeManager = {
    currentMode: 'circle',
    drawingMode: {
        currentLevel: 1,
        currentShape: null,
        startTime: null,
        timeLimit: 30,
        timer: null,
        isActive: false,
        shapes: [
            { 
                name: 'N√©gyzet', 
                icon: '‚¨ú', 
                points: [[0.2,0.2], [0.8,0.2], [0.8,0.8], [0.2,0.8], [0.2,0.2]],
                type: 'rectangle',
                minCorners: 4,
                expectedAngles: [90, 90, 90, 90]
            },
            { 
                name: 'H√°romsz√∂g', 
                icon: 'üî∫', 
                points: [[0.5,0.2], [0.8,0.8], [0.2,0.8], [0.5,0.2]],
                type: 'triangle',
                minCorners: 3,
                expectedAngles: [60, 60, 60]
            },
            { 
                name: 'K√∂r', 
                icon: '‚≠ï', 
                points: [], // K√∂r eset√©n nincs sz√ºks√©g pontokra
                type: 'circle',
                minCorners: 0,
                expectedAngles: []
            },
            { 
                name: 'Csillag', 
                icon: '‚≠ê', 
                points: [[0.5,0.1], [0.6,0.4], [0.9,0.4], [0.7,0.6], [0.8,0.9], [0.5,0.7], [0.2,0.9], [0.3,0.6], [0.1,0.4], [0.4,0.4], [0.5,0.1]],
                type: 'star',
                minCorners: 10,
                expectedAngles: []
            },
            { 
                name: 'Sz√≠v', 
                icon: '‚ù§Ô∏è', 
                points: [[0.5,0.3], [0.4,0.2], [0.3,0.2], [0.2,0.3], [0.2,0.4], [0.3,0.5], [0.5,0.8], [0.7,0.5], [0.8,0.4], [0.8,0.3], [0.7,0.2], [0.6,0.2], [0.5,0.3]],
                type: 'heart',
                minCorners: 0,
                expectedAngles: []
            }
        ],
        completedShapes: 0,
        totalTime: 0
    },
    
    showModeSelector: function() {
        const modal = document.getElementById('gameModeModal');
        if (modal) {
            modal.style.display = 'flex';
        }
    },
    
    selectMode: function(mode) {
        console.log(`üîÑ M√≥d v√°lt√°s: ${mode}`);
        this.currentMode = mode;
        localStorage.setItem('perfectcircle_gamemode', mode);
        
        const modal = document.getElementById('gameModeModal');
        if (modal) {
            modal.style.display = 'none';
        }
        
        if (mode === 'drawing') {
            this.initDrawingMode();
        } else {
            this.initCircleMode();
        }
    },
    
    initDrawingMode: function() {
        console.log('üé® Rajz m√≥d inicializ√°l√°sa...');
        document.body.classList.add('drawing-mode-active');
        this.createDrawingModeUI();
        this.startNewChallenge();
        this.setupDrawingDetection();
        this.blockOriginalShowScore();
    },
    
    initCircleMode: function() {
        console.log('üéØ Verseny m√≥d inicializ√°l√°sa...');
        document.body.classList.remove('drawing-mode-active');
        this.removeDrawingModeUI();
        this.restoreOriginalShowScore();
    },
    
    blockOriginalShowScore: function() {
        if (!this.originalShowScore) {
            this.originalShowScore = window.showScore;
        }
        
        window.showScore = function(score, analysis, transformationName = '') {
            console.log('üö´ showScore blokkolva rajz m√≥dban:', score);
            return;
        };
        
        console.log('üö´ Eredeti showScore blokkolva rajz m√≥dban');
    },
    
    restoreOriginalShowScore: function() {
        if (this.originalShowScore) {
            window.showScore = this.originalShowScore;
            console.log('üîÑ Eredeti showScore vissza√°ll√≠tva');
        }
    },
    
    createDrawingModeUI: function() {
        if (document.getElementById('shapeChallenge')) return;
        
        const statsContainer = document.querySelector('.stats-container');
        if (!statsContainer) return;
        
        const challengeDiv = document.createElement('div');
        challengeDiv.id = 'shapeChallenge';
        challengeDiv.className = 'shape-challenge';
        challengeDiv.innerHTML = `
            <h3>üé® Alakzat Kih√≠v√°s</h3>
            <div>Szint: <span id="currentLevel">1</span></div>
            <div class="current-shape" id="currentShapeDisplay">‚¨ú</div>
            <div>K√∂vesd le: <span id="currentShapeName">N√©gyzet</span></div>
            <div class="challenge-timer" id="challengeTimer">Kattints a "Rajzol√°s Kezd√©se" gombra!</div>
            <div class="challenge-progress">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
            <div>Teljes√≠tett: <span id="completedCount">0</span>/5</div>
            <div class="drawing-instructions">
                <small>üí° Rajzold le az alakzatot pontosan! A felismer√©s szigor√∫.</small>
            </div>
        `;
        
        statsContainer.insertAdjacentElement('afterend', challengeDiv);
    },
    
    removeDrawingModeUI: function() {
        const challengeDiv = document.getElementById('shapeChallenge');
        if (challengeDiv) {
            challengeDiv.remove();
        }
        
        if (this.drawingMode.timer) {
            clearInterval(this.drawingMode.timer);
            this.drawingMode.timer = null;
        }
    },
    
    startNewChallenge: function() {
        const shapeIndex = (this.drawingMode.currentLevel - 1) % this.drawingMode.shapes.length;
        this.drawingMode.currentShape = this.drawingMode.shapes[shapeIndex];
        this.drawingMode.isActive = false;
        
        this.updateChallengeUI();
        
        setTimeout(() => {
            this.clearCanvas();
            this.drawShapeGuide();
        }, 100);
        
        console.log(`üéØ √öj kih√≠v√°s: ${this.drawingMode.currentShape.name}`);
    },
    
    updateChallengeUI: function() {
        const levelSpan = document.getElementById('currentLevel');
        const shapeDisplay = document.getElementById('currentShapeDisplay');
        const shapeName = document.getElementById('currentShapeName');
        const completedCount = document.getElementById('completedCount');
        const timerElement = document.getElementById('challengeTimer');
        
        if (levelSpan) levelSpan.textContent = this.drawingMode.currentLevel;
        if (shapeDisplay) shapeDisplay.textContent = this.drawingMode.currentShape.icon;
        if (shapeName) shapeName.textContent = this.drawingMode.currentShape.name;
        if (completedCount) completedCount.textContent = this.drawingMode.completedShapes;
        if (timerElement) timerElement.textContent = 'Kattints a "Rajzol√°s Kezd√©se" gombra!';
        
        const startBtn = document.getElementById('startBtn');
        if (startBtn) {
            startBtn.textContent = 'üéØ Rajzol√°s Kezd√©se';
            startBtn.disabled = false;
        }
    },
    
    clearCanvas: function() {
        const canvas = document.getElementById('gameCanvas');
        if (canvas) {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
    },
    
    drawShapeGuide: function() {
        const canvas = document.getElementById('gameCanvas');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        const shape = this.drawingMode.currentShape;
        
        if (!shape) return;
        
        ctx.save();
        ctx.strokeStyle = 'rgba(33, 150, 243, 0.4)';
        ctx.lineWidth = 3;
        ctx.setLineDash([8, 8]);
        
        ctx.beginPath();
        
        if (shape.type === 'circle') {
            // K√∂r rajzol√°sa
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(canvas.width, canvas.height) * 0.3;
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
        } else if (shape.points && shape.points.length > 0) {
            // Pontok alapj√°n rajzol√°s
            shape.points.forEach((point, index) => {
                const x = point[0] * canvas.width;
                const y = point[1] * canvas.height;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
        }
        
        ctx.stroke();
        ctx.restore();
    },
    
setupDrawingDetection: function() {
    const canvas = document.getElementById('gameCanvas');
    if (!canvas) return;
    
    let isDrawing = false;
    let drawnPoints = [];
    
    // ‚úÖ PONTOK RAJZOL√ÅSA RAJZ M√ìDBAN
    
    // Touch esem√©nyek
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        if (this.currentMode === 'drawing' && this.drawingMode.isActive) {
            isDrawing = true;
            drawnPoints = [];
            
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const point = {
                x: touch.clientX - rect.left,
                y: touch.clientY - rect.top
            };
            
            drawnPoints.push(point);
            
            // ‚úÖ PONT RAJZOL√ÅSA (NEM VONAL)
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(point.x, point.y, 3, 0, 2 * Math.PI);
            ctx.fill();
            
            console.log('üé® Touch pontrajzol√°s kezd√©se:', point);
        }
    }, { passive: false });
    
    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        if (this.currentMode === 'drawing' && this.drawingMode.isActive && isDrawing) {
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const point = {
                x: touch.clientX - rect.left,
                y: touch.clientY - rect.top
            };
            
            drawnPoints.push(point);
            
            // ‚úÖ PONTOK RAJZOL√ÅSA (NEM VONALAK)
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(point.x, point.y, 3, 0, 2 * Math.PI);
            ctx.fill();
        }
    }, { passive: false });
    
    canvas.addEventListener('touchend', (e) => {
        e.preventDefault();
        if (this.currentMode === 'drawing' && this.drawingMode.isActive && isDrawing) {
            isDrawing = false;
            console.log('üèÅ Touch pontrajzol√°s befejezve, pontok:', drawnPoints.length);
            
            setTimeout(() => {
                this.evaluateDrawing(drawnPoints);
            }, 300);
        }
    }, { passive: false });
    
    canvas.addEventListener('touchcancel', (e) => {
        e.preventDefault();
        if (this.currentMode === 'drawing' && this.drawingMode.isActive && isDrawing) {
            isDrawing = false;
            console.log('‚ùå Touch pontrajzol√°s megszak√≠tva');
        }
    }, { passive: false });
    
    // Eg√©r esem√©nyek - DESKTOP
    canvas.addEventListener('mousedown', (e) => {
        if (this.currentMode === 'drawing' && this.drawingMode.isActive) {
            isDrawing = true;
            drawnPoints = [];
            
            const rect = canvas.getBoundingClientRect();
            const point = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
            
            drawnPoints.push(point);
            
            // ‚úÖ PONT RAJZOL√ÅSA EG√âRHEZ IS
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(point.x, point.y, 2, 0, 2 * Math.PI);
            ctx.fill();
            
            console.log('üé® Eg√©r pontrajzol√°s kezd√©se');
        }
    });
    
    canvas.addEventListener('mousemove', (e) => {
        if (this.currentMode === 'drawing' && this.drawingMode.isActive && isDrawing) {
            const rect = canvas.getBoundingClientRect();
            const point = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
            
            drawnPoints.push(point);
            
            // ‚úÖ PONTOK RAJZOL√ÅSA
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(point.x, point.y, 2, 0, 2 * Math.PI);
            ctx.fill();
        }
    });
    
    canvas.addEventListener('mouseup', () => {
        if (this.currentMode === 'drawing' && this.drawingMode.isActive && isDrawing) {
            isDrawing = false;
            console.log('üèÅ Eg√©r pontrajzol√°s befejezve, pontok:', drawnPoints.length);
            
            setTimeout(() => {
                this.evaluateDrawing(drawnPoints);
            }, 300);
        }
    });
    
    console.log('‚úÖ Pontrajzol√°s be√°ll√≠tva rajz m√≥dhoz');
},


    
    startTimer: function() {
        if (this.drawingMode.timer) {
            clearInterval(this.drawingMode.timer);
        }
        
        this.drawingMode.startTime = Date.now();
        this.drawingMode.isActive = true;
        let timeLeft = this.drawingMode.timeLimit;
        
        const timerElement = document.getElementById('challengeTimer');
        const progressBar = document.getElementById('progressBar');
        const startBtn = document.getElementById('startBtn');
        
        if (startBtn) {
            startBtn.textContent = 'üéØ Rajzold le az alakzatot!';
            startBtn.disabled = true;
        }
        
        console.log('‚è∞ Timer elind√≠tva!');
        
        this.drawingMode.timer = setInterval(() => {
            timeLeft--;
            
            if (timerElement) {
                timerElement.textContent = timeLeft + 's';
                timerElement.style.color = timeLeft <= 10 ? '#f44336' : '#ff9800';
            }
            
            if (progressBar) {
                const progress = ((this.drawingMode.timeLimit - timeLeft) / this.drawingMode.timeLimit) * 100;
                progressBar.style.width = progress + '%';
            }
            
            if (timeLeft <= 0) {
                this.timeUp();
            }
        }, 1000);
    },
    
    timeUp: function() {
        clearInterval(this.drawingMode.timer);
        this.drawingMode.timer = null;
        this.drawingMode.isActive = false;
        
        alert(`‚è∞ Id≈ë lej√°rt!\n\nNem siker√ºlt befejezni: ${this.drawingMode.currentShape.name}\n\nPr√≥b√°ld √∫jra!`);
        
        setTimeout(() => {
            this.startNewChallenge();
        }, 1000);
    },
    
    evaluateDrawing: function(drawnPoints) {
        if (!this.drawingMode.isActive) return;
        
        // Timer le√°ll√≠t√°sa
        if (this.drawingMode.timer) {
            clearInterval(this.drawingMode.timer);
            this.drawingMode.timer = null;
        }
        
        this.drawingMode.isActive = false;
        
        if (drawnPoints.length < 10) {
            this.showFailureMessage(0, 'T√∫l r√∂vid rajz!', 'Rajzolj egy teljes alakzatot!');
            return;
        }
        
        // ‚úÖ INTELLIGENS ALAKZAT FELISMER√âS
        const analysis = this.analyzeShape(drawnPoints);
        const score = this.calculateSmartScore(analysis);
        
        console.log(`üìä Alakzat anal√≠zis:`, analysis);
        console.log(`üìä V√âGLEGES PONTSZ√ÅM: ${score}`);
        
        this.updateGameStats(score);
        this.showDrawingScoreDisplay(score, analysis);
        
        if (score >= 70) {
            this.saveDrawingScore(score);
            setTimeout(() => {
                this.shapeCompleted(score);
            }, 2000);
        } else {
            setTimeout(() => {
                this.showFailureMessage(score, 'Nem siker√ºlt!', analysis.feedback);
            }, 2000);
        }
    },
    
    // ‚úÖ INTELLIGENS ALAKZAT ANAL√çZIS
    analyzeShape: function(drawnPoints) {
        const shape = this.drawingMode.currentShape;
        const analysis = {
            shapeType: shape.type,
            shapeName: shape.name,
            accuracy: 0,
            feedback: '',
            details: {}
        };
        
        // Pontok sim√≠t√°sa (zajsz≈±r√©s)
        const smoothedPoints = this.smoothPoints(drawnPoints);
        
        switch (shape.type) {
            case 'rectangle':
                return this.analyzeRectangle(smoothedPoints, analysis);
            case 'triangle':
                return this.analyzeTriangle(smoothedPoints, analysis);
            case 'circle':
                return this.analyzeCircle(smoothedPoints, analysis);
            case 'star':
                return this.analyzeStar(smoothedPoints, analysis);
            case 'heart':
                return this.analyzeHeart(smoothedPoints, analysis);
            default:
                analysis.accuracy = 0;
                analysis.feedback = 'Ismeretlen alakzat';
                return analysis;
        }
    },
    
    // Pontok sim√≠t√°sa
    smoothPoints: function(points) {
        if (points.length < 3) return points;
        
        const smoothed = [points[0]];
        
        for (let i = 1; i < points.length - 1; i++) {
            const prev = points[i - 1];
            const curr = points[i];
            const next = points[i + 1];
            
            const smoothX = (prev.x + curr.x + next.x) / 3;
            const smoothY = (prev.y + curr.y + next.y) / 3;
            
            smoothed.push({ x: smoothX, y: smoothY });
        }
        
        smoothed.push(points[points.length - 1]);
        return smoothed;
    },
    
    // N√©gyzet anal√≠zis
    analyzeRectangle: function(points, analysis) {
        const corners = this.findCorners(points);
        analysis.details.corners = corners.length;
        
        if (corners.length < 4) {
            analysis.accuracy = Math.max(0, corners.length * 20);
            analysis.feedback = `Csak ${corners.length} sarok tal√°lhat√≥, 4 kell!`;
            return analysis;
        }
        
        // Sz√∂gek ellen≈ërz√©se
        const angles = this.calculateAngles(corners);
        const rightAngles = angles.filter(angle => Math.abs(angle - 90) < 15).length;
        
        // Oldalak hossz√°nak ellen≈ërz√©se
        const sides = this.calculateSideLengths(corners);
        const avgSide = sides.reduce((a, b) => a + b, 0) / sides.length;
        const sideVariation = Math.max(...sides) / Math.min(...sides);
        
        // Pontsz√°m√≠t√°s
        let accuracy = 0;
        accuracy += rightAngles * 15; // 15 pont sarokonk√©nt
        accuracy += Math.max(0, 40 - (sideVariation - 1) * 100); // Oldalar√°ny
        
        analysis.accuracy = Math.min(100, accuracy);
        analysis.details.rightAngles = rightAngles;
        analysis.details.sideVariation = sideVariation.toFixed(2);
        
        if (accuracy >= 70) {
            analysis.feedback = 'J√≥ n√©gyzet!';
        } else {
            analysis.feedback = `${rightAngles}/4 j√≥ sz√∂g, oldalar√°ny: ${sideVariation.toFixed(2)}`;
        }
        
        return analysis;
    },
    
    // H√°romsz√∂g anal√≠zis
    analyzeTriangle: function(points, analysis) {
        const corners = this.findCorners(points);
        analysis.details.corners = corners.length;
        
        if (corners.length < 3) {
            analysis.accuracy = Math.max(0, corners.length * 25);
            analysis.feedback = `Csak ${corners.length} sarok tal√°lhat√≥, 3 kell!`;
            return analysis;
        }
        
        // Z√°r√≥d√°s ellen≈ërz√©se
        const isClosed = this.isShapeClosed(points);
        const closureBonus = isClosed ? 30 : 0;
        
        // Sz√∂gek √∂sszege (180¬∞ kell legyen)
        const angles = this.calculateAngles(corners.slice(0, 3));
        const angleSum = angles.reduce((a, b) => a + b, 0);
        const angleSumAccuracy = Math.max(0, 40 - Math.abs(angleSum - 180) * 2);
        
        analysis.accuracy = Math.min(100, closureBonus + angleSumAccuracy + 30);
        analysis.details.angleSum = Math.round(angleSum);
        analysis.details.isClosed = isClosed;
        
        if (analysis.accuracy >= 70) {
            analysis.feedback = 'J√≥ h√°romsz√∂g!';
        } else {
            analysis.feedback = `Sz√∂g√∂sszeg: ${Math.round(angleSum)}¬∞ (180¬∞ kell)`;
        }
        
        return analysis;
    },
    
    // K√∂r anal√≠zis
    analyzeCircle: function(points, analysis) {
        if (points.length < 20) {
            analysis.accuracy = 0;
            analysis.feedback = 'T√∫l kev√©s pont a k√∂rh√∂z!';
            return analysis;
        }
        
        // K√∂zpont meghat√°roz√°sa
        const center = this.findCenter(points);
        
        // T√°vols√°gok a k√∂zpontt√≥l
        const distances = points.map(p => 
            Math.sqrt((p.x - center.x) ** 2 + (p.y - center.y) ** 2)
        );
        
        const avgRadius = distances.reduce((a, b) => a + b, 0) / distances.length;
        const radiusVariation = Math.max(...distances) / Math.min(...distances);
        
        // Z√°r√≥d√°s ellen≈ërz√©se
        const isClosed = this.isShapeClosed(points);
        
        // Pontsz√°m√≠t√°s
        let accuracy = 0;
        accuracy += isClosed ? 40 : 0; // Z√°r√≥d√°s
        accuracy += Math.max(0, 60 - (radiusVariation - 1) * 200); // K√∂ralak
        
        analysis.accuracy = Math.min(100, accuracy);
        analysis.details.radiusVariation = radiusVariation.toFixed(2);
        analysis.details.isClosed = isClosed;
        
        if (accuracy >= 70) {
            analysis.feedback = 'J√≥ k√∂r!';
        } else {
            analysis.feedback = `Sug√°rv√°ltoz√°s: ${radiusVariation.toFixed(2)} (1.0 a t√∂k√©letes)`;
        }
        
        return analysis;
    },
    
    // Csillag √©s sz√≠v egyszer≈±s√≠tett anal√≠zis
    analyzeStar: function(points, analysis) {
        const corners = this.findCorners(points);
        const minCorners = 8; // Csillaghoz minimum 8 sarok
        
        analysis.accuracy = Math.min(100, (corners.length / minCorners) * 80 + 20);
        analysis.details.corners = corners.length;
        analysis.feedback = corners.length >= minCorners ? 'J√≥ csillag!' : `${corners.length}/${minCorners} sarok`;
        
        return analysis;
    },
    
    analyzeHeart: function(points, analysis) {
        // Sz√≠v eset√©n egyszer≈±bb: z√°r√≥d√°s √©s forma komplexit√°s
        const isClosed = this.isShapeClosed(points);
        const complexity = points.length > 50 ? 60 : points.length;
        
        analysis.accuracy = (isClosed ? 40 : 0) + complexity;
        analysis.details.isClosed = isClosed;
        analysis.details.complexity = points.length;
        analysis.feedback = isClosed ? 'J√≥ sz√≠v!' : 'A sz√≠v nincs lez√°rva!';
        
        return analysis;
    },
    
    // Seg√©df√ºggv√©nyek
    findCorners: function(points) {
        if (points.length < 3) return [];
        
        const corners = [];
        const angleThreshold = 30; // fok
        
        for (let i = 1; i < points.length - 1; i++) {
            const prev = points[i - 1];
            const curr = points[i];
            const next = points[i + 1];
            
            const angle1 = Math.atan2(curr.y - prev.y, curr.x - prev.x);
            const angle2 = Math.atan2(next.y - curr.y, next.x - curr.x);
            
            let angleDiff = Math.abs(angle2 - angle1) * 180 / Math.PI;
            if (angleDiff > 180) angleDiff = 360 - angleDiff;
            
            if (angleDiff > angleThreshold) {
                corners.push(curr);
            }
        }
        
        return corners;
    },
    
    calculateAngles: function(corners) {
        if (corners.length < 3) return [];
        
        const angles = [];
        
        for (let i = 0; i < corners.length; i++) {
            const prev = corners[(i - 1 + corners.length) % corners.length];
            const curr = corners[i];
            const next = corners[(i + 1) % corners.length];
            
            const angle1 = Math.atan2(prev.y - curr.y, prev.x - curr.x);
            const angle2 = Math.atan2(next.y - curr.y, next.x - curr.x);
            
            let angle = Math.abs(angle2 - angle1) * 180 / Math.PI;
            if (angle > 180) angle = 360 - angle;
            
            angles.push(angle);
        }
        
        return angles;
    },
    
    calculateSideLengths: function(corners) {
        const sides = [];
        
        for (let i = 0; i < corners.length; i++) {
            const curr = corners[i];
            const next = corners[(i + 1) % corners.length];
            
            const length = Math.sqrt((next.x - curr.x) ** 2 + (next.y - curr.y) ** 2);
            sides.push(length);
        }
        
        return sides;
    },
    
    findCenter: function(points) {
        const sumX = points.reduce((sum, p) => sum + p.x, 0);
        const sumY = points.reduce((sum, p) => sum + p.y, 0);
        
        return {
            x: sumX / points.length,
            y: sumY / points.length
        };
    },
    
    isShapeClosed: function(points) {
        if (points.length < 3) return false;
        
        const first = points[0];
        const last = points[points.length - 1];
        const distance = Math.sqrt((last.x - first.x) ** 2 + (last.y - first.y) ** 2);
        
        return distance < 50; // 50 pixel tolerancia
    },
    
    // ‚úÖ OKOS PONTSZ√ÅM√çT√ÅS
    calculateSmartScore: function(analysis) {
        let baseScore = analysis.accuracy;
        
        // Id≈ë b√≥nusz/b√ºntet√©s
        const elapsedTime = (Date.now() - this.drawingMode.startTime) / 1000;
        let timeMultiplier = 1.0;
        
        if (elapsedTime < 10) {
            timeMultiplier = 1.1; // 10% b√≥nusz
        } else if (elapsedTime > 25) {
            timeMultiplier = 0.9; // 10% b√ºntet√©s
        }
        
        const finalScore = Math.max(0, Math.min(100, Math.round(baseScore * timeMultiplier)));
        
        console.log(`üßÆ Okos pontsz√°m√≠t√°s:
            - Alakzat pontoss√°g: ${baseScore.toFixed(1)}
            - Id≈ë (${elapsedTime.toFixed(1)}s): ${timeMultiplier}x
            - V√âGS≈ê: ${finalScore}`);
        
        return finalScore;
    },
    
    showDrawingScoreDisplay: function(score, analysis) {
        const scoreDisplay = document.getElementById('scoreDisplay');
        const finalScore = document.getElementById('finalScore');
        const currentScore = document.getElementById('currentScore');
        const scoreBreakdown = document.getElementById('scoreBreakdown');
        
        if (finalScore) finalScore.textContent = score;
        if (currentScore) currentScore.textContent = score;
        
        if (scoreBreakdown && analysis) {
            const elapsedTime = (Date.now() - this.drawingMode.startTime) / 1000;
            
            scoreBreakdown.innerHTML = `
                <div>üé® ${analysis.shapeName}: ${score}/100</div>
                <div>‚è±Ô∏è Id≈ë: ${elapsedTime.toFixed(1)}s</div>
                <div>üéØ Pontoss√°g: ${analysis.accuracy.toFixed(1)}%</div>
                <div>üí¨ ${analysis.feedback}</div>
                ${analysis.details.corners ? `<div>üìê Sarkok: ${analysis.details.corners}</div>` : ''}
                ${analysis.details.isClosed !== undefined ? `<div>üîó Z√°rt: ${analysis.details.isClosed ? 'Igen' : 'Nem'}</div>` : ''}
            `;
        }
        
        if (scoreDisplay) {
            scoreDisplay.style.display = 'block';
            scoreDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        console.log(`üìä Score display friss√≠tve: ${score} pont`);
    },
    
    updateGameStats: function(score) {
        try {
            const currentScoreElement = document.getElementById('currentScore');
            if (currentScoreElement) {
                currentScoreElement.textContent = score;
            }
            
            if (window.updateStats) {
                setTimeout(() => {
                    window.updateStats();
                }, 100);
            }
            
            console.log('üìä Statisztik√°k friss√≠tve:', score);
        } catch (error) {
            console.error('‚ùå Statisztika friss√≠t√©si hiba:', error);
        }
    },
    
    saveDrawingScore: function(score) {
        try {
            if (window.ScoreManager && window.ScoreManager.saveScore) {
                const playerName = document.getElementById('playerName')?.value?.trim() || 'N√©vtelen';
                const shapeName = this.drawingMode.currentShape.name;
                
                const analysis = {
                    shape: score * 0.4,
                    closure: score * 0.2,
                    smoothness: score * 0.25,
                    size: score * 0.15
                };
                
                const savedScore = window.ScoreManager.saveScore(
                    score,
                    analysis,
                    'drawing',
                    `Rajz: ${shapeName}`
                );
                
                console.log('üíæ Rajz m√≥d score mentve:', savedScore);
                
                setTimeout(() => {
                    if (window.currentLeaderboardType === 'local' && window.refreshLeaderboard) {
                        window.refreshLeaderboard();
                    }
                }, 200);
            }
        } catch (error) {
            console.error('‚ùå Score ment√©si hiba:', error);
        }
    },
    
    showFailureMessage: function(score, message, details = '') {
        const overlay = document.createElement('div');
        overlay.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(244, 67, 54, 0.9); display: flex; justify-content: center; align-items: center;
            z-index: 10000; color: white; font-size: 2em; text-align: center;
        `;
        
        overlay.innerHTML = `
            <div>
                <div style="font-size: 4em; margin-bottom: 20px;">‚ùå</div>
                <div>${message}</div>
                <div style="font-size: 0.8em; margin-top: 10px;">${score}/100 pont</div>
                <div style="font-size: 0.6em; margin-top: 5px;">Legal√°bb 70 pont kell!</div>
                ${details ? `<div style="font-size: 0.5em; margin-top: 10px;">${details}</div>` : ''}
                <div style="font-size: 0.5em; margin-top: 15px;">√öjra pr√≥b√°lkoz√°s...</div>
            </div>
        `;
        
        document.body.appendChild(overlay);
        
        setTimeout(() => {
            if (overlay.parentNode) {
                overlay.parentNode.removeChild(overlay);
            }
            this.startNewChallenge();
        }, 4000);
    },
    
    shapeCompleted: function(score) {
        const elapsedTime = (Date.now() - this.drawingMode.startTime) / 1000;
        this.drawingMode.totalTime += elapsedTime;
        this.drawingMode.completedShapes++;
        
        const overlay = document.createElement('div');
        overlay.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(76, 175, 80, 0.9); display: flex; justify-content: center; align-items: center;
            z-index: 10000; color: white; font-size: 2em; text-align: center;
        `;
        
        overlay.innerHTML = `
            <div>
                <div style="font-size: 4em; margin-bottom: 20px;">‚úÖ</div>
                <div>Alakzat Teljes√≠tve!</div>
                <div style="font-size: 0.8em; margin-top: 10px;">${score} pont</div>
                <div style="font-size: 0.6em; margin-top: 5px;">${elapsedTime.toFixed(1)}s</div>
            </div>
        `;
        
        document.body.appendChild(overlay);
        
        setTimeout(() => {
            if (overlay.parentNode) {
                overlay.parentNode.removeChild(overlay);
            }
            
            if (this.drawingMode.completedShapes >= 5) {
                this.levelCompleted();
            } else {
                this.drawingMode.currentLevel++;
                this.startNewChallenge();
            }
        }, 3000);
    },
    
    levelCompleted: function() {
        const avgTime = (this.drawingMode.totalTime / 5).toFixed(1);
        alert(`üèÜ Szint Teljes√≠tve!\n\n‚úÖ 5/5 alakzat teljes√≠tve\n‚è±Ô∏è √Åtlag id≈ë: ${avgTime}s\n\nK√∂vetkez≈ë szint indul...`);
        
        this.drawingMode.completedShapes = 0;
        this.drawingMode.totalTime = 0;
        setTimeout(() => {
            this.startNewChallenge();
        }, 1000);
    },
    
    init: function() {
        const savedMode = localStorage.getItem('perfectcircle_gamemode');
        
        if (!savedMode) {
            setTimeout(() => {
                this.showModeSelector();
            }, 1000);
        } else {
            this.currentMode = savedMode;
            if (savedMode === 'drawing') {
                setTimeout(() => {
                    this.initDrawingMode();
                }, 1000);
            }
        }
    }
};

// Glob√°lis f√ºggv√©nyek
window.selectGameMode = function(mode) {
    window.GameModeManager.selectMode(mode);
};

// Start gomb override rajz m√≥dhoz
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        const startBtn = document.getElementById('startBtn');
        if (startBtn) {
            startBtn.addEventListener('click', function() {
                if (window.GameModeManager.currentMode === 'drawing') {
                    if (!window.GameModeManager.drawingMode.isActive) {
                        console.log('üé® Rajz m√≥d timer ind√≠t√°sa');
                        window.GameModeManager.startTimer();
                    }
                } else {
                    // Norm√°l k√∂r j√°t√©k
                    if (window.gameEngine && window.gameEngine.startDrawing) {
                        window.gameEngine.startDrawing();
                    }
                }
            });
        }
        
        window.GameModeManager.init();
    }, 2000);
});

console.log('‚úÖ Intelligens alakzat felismer≈ë GameModeManager bet√∂ltve');
</script>


    <!-- JavaScript f√°jlok bet√∂lt√©se -->
    <script>
        
        // Glob√°lis nyelvi adatok t√°rol√≥ja
        window.languageData = {};
        
        // Magyar nyelv be√°gyaz√°sa (egyszer≈±s√≠tett verzi√≥)
        window.languageData.hu = {
            title: "Perfect Circle - Rajzolj T√∂k√©letes K√∂rt!",
            subtitle: "Rajzolj a lehet≈ë legt√∂k√©letesebb k√∂rt egyetlen mozdulattal!",
            instructions: {
                title: "üéÆ Hogyan j√°tssz:",
                text: "Kattints √©s h√∫zd az egeret (vagy √©rintsd √©s h√∫zd az ujjad) hogy egy k√∂rt rajzolj. Min√©l t√∂k√©letesebb a k√∂r√∂d, ann√°l t√∂bb pontot kapsz! A k√∂r var√°zslatos m√≥don √°t fog v√°ltozni! ‚ú®"
            },
            buttons: {
                startDrawing: "üéØ Rajzol√°s Kezd√©se",
                clear: "üóëÔ∏è T√∂rl√©s",
                help: "‚ùì Seg√≠ts√©g",
                save: "üíæ Ment√©s",
                clearScores: "üóëÔ∏è Helyi Eredm√©nyek T√∂rl√©se",
                guide: "üìç Seg√©dvonal",
                switchMode: "üîÑ M√≥d V√°lt√°s" 


            },
            player: {
                label: "N√©v:",
                placeholder: "Add meg a neved"
            },
            difficulty: {
                label: "üéØ Neh√©zs√©g:",
                easy: "K√∂nny≈± üòä",
                hard: "Neh√©z üåÄ"
            },
            stats: {
                currentScore: "Jelenlegi Pontsz√°m",
                bestScore: "Legjobb Eredm√©ny",
                gamesPlayed: "J√°t√©kok Sz√°ma",
                averageScore: "√Åtlag Pontsz√°m"
            },
            leaderboard: {
                title: "üèÜ Ranglista",
                localResults: "üì± Helyi eredm√©nyek",
                noResults: "M√©g nincsenek eredm√©nyek"
            },
            common: {
                points: "pont"
            },
            scoreTitle: {
                result: "üèÜ Eredm√©ny"
            },
            transformation: {
                magic: "‚ú® Var√°zslat t√∂rt√©nik... ‚ú®"
            },
            firebase: {
                connecting: "üü° Kapcsol√≥d√°s...",
                offlineNotice: "‚ö†Ô∏è <strong>Offline m√≥d:</strong> A glob√°lis ranglista nem el√©rhet≈ë. Az eredm√©nyek helyben ment≈ëdnek."
            },
            visitors: {
                label: "üë• L√°togat√°sok:"
            },
            dev: {
                version: "v2.1",
                debug: "Debug"
            }
        };
    </script>

    <!-- THUMBNAIL GENERATOR BE√ÅGYAZVA -->
    <script>
        
        // js/utils/thumbnailGenerator.js - BE√ÅGYAZVA
        window.ThumbnailGenerator = {
            
            // Canvas tartalom ment√©se thumbnail-k√©nt
            captureCanvasThumbnail: function(canvasId, maxWidth = 100, maxHeight = 100, quality = 0.8) {
                try {
                    const canvas = document.getElementById(canvasId);
                    if (!canvas) {
                        console.error('‚ùå Canvas nem tal√°lhat√≥:', canvasId);
                        return null;
                    }
                    
                    // Thumbnail canvas l√©trehoz√°sa
                    const thumbCanvas = document.createElement('canvas');
                    const thumbCtx = thumbCanvas.getContext('2d');
                    
                    // Ar√°nyos √°tm√©retez√©s sz√°m√≠t√°sa
                    const originalWidth = canvas.width;
                    const originalHeight = canvas.height;
                    const aspectRatio = originalWidth / originalHeight;
                    
                    let thumbWidth = maxWidth;
                    let thumbHeight = maxHeight;
                    
                    if (aspectRatio > 1) {
                        thumbHeight = maxWidth / aspectRatio;
                    } else {
                        thumbWidth = maxHeight * aspectRatio;
                    }
                    
                    thumbCanvas.width = Math.round(thumbWidth);
                    thumbCanvas.height = Math.round(thumbHeight);
                    
                    // H√°tt√©r be√°ll√≠t√°sa (√°tl√°tsz√≥ helyett feh√©r)
                    thumbCtx.fillStyle = '#ffffff';
                    thumbCtx.fillRect(0, 0, thumbCanvas.width, thumbCanvas.height);
                    
                    // Eredeti canvas tartalom √°tm√°sol√°sa
                    thumbCtx.drawImage(canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);
                    
                    // Base64 string visszaad√°sa
                    const thumbnailData = thumbCanvas.toDataURL('image/jpeg', quality);
                    
                    console.log('‚úÖ Thumbnail k√©sz√≠tve:', {
                        originalSize: `${originalWidth}x${originalHeight}`,
                        thumbnailSize: `${thumbCanvas.width}x${thumbCanvas.height}`,
                        dataSize: Math.round(thumbnailData.length / 1024) + 'KB'
                    });
                    
                    return thumbnailData;
                    
                } catch (error) {
                    console.error('‚ùå Thumbnail k√©sz√≠t√©si hiba:', error);
                    return null;
                }
            },

            // Transzform√°ci√≥ ut√°n thumbnail k√©sz√≠t√©s
            captureTransformationThumbnail: function(delay = 500) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        // Pr√≥b√°ljuk meg a gameCanvas-r√≥l
                        let thumbnail = this.captureCanvasThumbnail('gameCanvas');
                        
                        // Ha nincs, pr√≥b√°ljuk az idealCircleCanvas-r√≥l
                        if (!thumbnail) {
                            thumbnail = this.captureCanvasThumbnail('idealCircleCanvas');
                        }
                        
                        resolve(thumbnail);
                    }, delay);
                });
            },

            // Thumbnail megjelen√≠t√©se DOM elemben
            displayThumbnail: function(thumbnailData, containerId, className = 'score-thumbnail') {
                try {
                    if (!thumbnailData) return false;
                    
                    const container = document.getElementById(containerId);
                    if (!container) return false;
                    
                    // Megl√©v≈ë thumbnail elt√°vol√≠t√°sa
                    const existingThumbnail = container.querySelector('.' + className);
                    if (existingThumbnail) {
                        existingThumbnail.remove();
                    }
                    
                    // √öj thumbnail elem l√©trehoz√°sa
                    const img = document.createElement('img');
                    img.src = thumbnailData;
                    img.className = className;
                    img.style.cssText = `
                        width: 60px;
                        height: 60px;
                        object-fit: cover;
                        border-radius: 8px;
                        border: 2px solid #ddd;
                        margin-left: 10px;
                        cursor: pointer;
                        transition: transform 0.2s;
                    `;
                    
                    // Hover effekt
                    img.addEventListener('mouseenter', () => {
                        img.style.transform = 'scale(1.1)';
                    });
                    
                    img.addEventListener('mouseleave', () => {
                        img.style.transform = 'scale(1)';
                    });
                    
                    // Kattint√°sra nagy√≠t√°s
                    img.addEventListener('click', () => {
                        this.showThumbnailModal(thumbnailData);
                    });
                    
                    container.appendChild(img);
                    return true;
                    
                } catch (error) {
                    console.error('‚ùå Thumbnail megjelen√≠t√©si hiba:', error);
                    return false;
                }
            },

            // Thumbnail modal megjelen√≠t√©se
            showThumbnailModal: function(thumbnailData) {
                // Modal l√©trehoz√°sa
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    cursor: pointer;
                `;
                
                const img = document.createElement('img');
                img.src = thumbnailData;
                img.style.cssText = `
                    max-width: 90%;
                    max-height: 90%;
                    border-radius: 10px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
                `;
                
                modal.appendChild(img);
                document.body.appendChild(modal);
                
                // Kattint√°sra bez√°r√°s
                modal.addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                // ESC billenty≈±re bez√°r√°s
                const escHandler = (e) => {
                    if (e.key === 'Escape') {
                        document.body.removeChild(modal);
                        document.removeEventListener('keydown', escHandler);
                    }
                };
                document.addEventListener('keydown', escHandler);
            }
        };

        console.log('‚úÖ ThumbnailGenerator bet√∂ltve');
    </script>

    <!-- SCORE ANIMATOR -->
    <script>
        window.ScoreAnimator = {
            
            // F≈ëbb anim√°ci√≥ ind√≠t√°sa
            animateScore: function(score, breakdown, transformationName = '') {
                console.log('üéâ Score anim√°ci√≥ ind√≠t√°sa:', score);
                
                try {
                    // Score kateg√≥ria meghat√°roz√°sa
                    const category = this.getScoreCategory(score);
                    
                    // Nagy score felfed√©s
                    this.showBigScoreReveal(score, category);
                    
                    // R√©szletek anim√°l√°sa
                    setTimeout(() => {
                        this.animateScoreBreakdown(breakdown);
                    }, 1500);
                    
                    // Egy√©b effektek
                    setTimeout(() => {
                        this.addScoreEffects(score, category);
                    }, 500);
                    
                    // Score display anim√°l√°sa
                    setTimeout(() => {
                        this.animateScoreDisplay(score, category);
                    }, 2000);
                    
                } catch (error) {
                    console.error('‚ùå Score anim√°ci√≥ hiba:', error);
                }
            },
            
            // Score kateg√≥ria meghat√°roz√°sa
            getScoreCategory: function(score) {
                if (score >= 95) return { name: 'perfect', text: 'T√ñK√âLETES!', emoji: 'üèÜ' };
                if (score >= 85) return { name: 'excellent', text: 'KIV√ÅL√ì!', emoji: '‚≠ê' };
                if (score >= 70) return { name: 'good', text: 'J√ì!', emoji: 'üëç' };
                if (score >= 50) return { name: 'fair', text: 'ELFOGADHAT√ì', emoji: 'üëå' };
                return { name: 'poor', text: 'GYAKOROLJ M√âG!', emoji: 'üí™' };
            },
            
            // Nagy score felfed√©s
            showBigScoreReveal: function(score, category) {
                // Overlay l√©trehoz√°sa
                const overlay = document.createElement('div');
                overlay.className = 'score-animation-overlay';
                
                // Score sz√∂veg
                const scoreText = document.createElement('div');
                scoreText.className = `score-big-reveal score-${category.name}`;
                scoreText.innerHTML = `
                    <div style="font-size: 0.3em; margin-bottom: 10px;">${category.emoji} ${category.text} ${category.emoji}</div>
                    <div>${Math.round(score)}</div>
                    <div style="font-size: 0.4em; margin-top: 10px;">PONT</div>
                `;
                
                overlay.appendChild(scoreText);
                document.body.appendChild(overlay);
                
                // Hang lej√°tsz√°sa (ha van AudioManager)
                if (window.AudioManager && window.AudioManager.playScoreReveal) {
                    window.AudioManager.playScoreReveal(score);
                }
                
                // Elt√°vol√≠t√°s
                setTimeout(() => {
                    if (overlay.parentNode) {
                        overlay.parentNode.removeChild(overlay);
                    }
                }, 3000);
            },
            
            // Score breakdown anim√°l√°sa
            animateScoreBreakdown: function(breakdown) {
                const scoreBreakdown = document.getElementById('scoreBreakdown');
                if (!scoreBreakdown || !breakdown) return;
                
                // Elemek anim√°l√°sa egyenk√©nt
                const items = scoreBreakdown.querySelectorAll('div');
                items.forEach((item, index) => {
                    item.style.opacity = '0';
                    item.style.transform = 'translateX(-50px)';
                    item.style.transition = 'all 0.5s ease';
                    
                    setTimeout(() => {
                        item.style.opacity = '1';
                        item.style.transform = 'translateX(0)';
                    }, index * 200);
                });
            },
            
            // Score display anim√°l√°sa
            animateScoreDisplay: function(score, category) {
                const scoreDisplay = document.getElementById('scoreDisplay');
                if (!scoreDisplay) return;
                
                // CSS class hozz√°ad√°sa
                scoreDisplay.classList.add('score-revealed');
                
                // Badge hozz√°ad√°sa
                this.addScoreBadge(scoreDisplay, category);
                
                // Class elt√°vol√≠t√°sa
                setTimeout(() => {
                    scoreDisplay.classList.remove('score-revealed');
                }, 2000);
            },
            
            // Score badge hozz√°ad√°sa
            addScoreBadge: function(container, category) {
                // Megl√©v≈ë badge elt√°vol√≠t√°sa
                const existingBadge = container.querySelector('.score-grade-badge');
                if (existingBadge) {
                    existingBadge.remove();
                }
                
                // √öj badge
                const badge = document.createElement('div');
                badge.className = 'score-grade-badge';
                badge.textContent = category.emoji + ' ' + category.text;
                
                container.style.position = 'relative';
                container.appendChild(badge);
                
                // Badge elt√°vol√≠t√°sa
                setTimeout(() => {
                    if (badge.parentNode) {
                        badge.parentNode.removeChild(badge);
                    }
                }, 3000);
            },
            
            // Egy√©b effektek
            addScoreEffects: function(score, category) {
                // Particle effekt
                this.createParticles(score);
                
                // Confetti nagy score eset√©n
                if (score >= 80) {
                    this.createConfetti();
                }
                
                // T≈±zij√°t√©k t√∂k√©letes score eset√©n
                if (score >= 95) {
                    this.createFireworks();
                }
            },
            
            // Particle effekt
            createParticles: function(score) {
                const container = document.createElement('div');
                container.className = 'score-particles';
                
                const particleCount = Math.min(score / 2, 50);
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'score-particle';
                    
                    // Random poz√≠ci√≥ √©s ir√°ny
                    const angle = (Math.PI * 2 * i) / particleCount;
                    const distance = 100 + Math.random() * 100;
                    const dx = Math.cos(angle) * distance;
                    const dy = Math.sin(angle) * distance;
                    
                    particle.style.setProperty('--dx', dx + 'px');
                    particle.style.setProperty('--dy', dy + 'px');
                    particle.style.backgroundColor = this.getRandomColor();
                    particle.style.animationDelay = Math.random() * 0.5 + 's';
                    
                    container.appendChild(particle);
                }
                
                document.body.appendChild(container);
                
                // Elt√°vol√≠t√°s
                setTimeout(() => {
                    if (container.parentNode) {
                        container.parentNode.removeChild(container);
                    }
                }, 2000);
            },
            
            // Confetti l√©trehoz√°sa
            createConfetti: function() {
                const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'];
                
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.animationDelay = Math.random() * 2 + 's';
                        
                        document.body.appendChild(confetti);
                        
                        setTimeout(() => {
                            if (confetti.parentNode) {
                                confetti.parentNode.removeChild(confetti);
                            }
                        }, 3000);
                    }, i * 50);
                }
            },
            
            // T≈±zij√°t√©k
            createFireworks: function() {
                const colors = ['#FFD700', '#FF1744', '#00E676', '#2196F3', '#FF9800'];
                
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const container = document.createElement('div');
                        container.className = 'score-fireworks';
                        
                        const centerX = Math.random() * window.innerWidth;
                        const centerY = Math.random() * window.innerHeight * 0.5 + window.innerHeight * 0.2;
                        
                        for (let j = 0; j < 20; j++) {
                            const firework = document.createElement('div');
                            firework.className = 'firework';
                            firework.style.left = centerX + 'px';
                            firework.style.top = centerY + 'px';
                            firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                            firework.style.animationDelay = Math.random() * 0.5 + 's';
                            
                            container.appendChild(firework);
                        }
                        
                        document.body.appendChild(container);
                        
                        setTimeout(() => {
                            if (container.parentNode) {
                                container.parentNode.removeChild(container);
                            }
                        }, 1500);
                    }, i * 300);
                }
            },
            
            // Random sz√≠n
            getRandomColor: function() {
                const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
                return colors[Math.floor(Math.random() * colors.length)];
            },
            
            // Vibr√°ci√≥ (mobil)
            vibrate: function(score) {
                if (navigator.vibrate) {
                    if (score >= 95) {
                        navigator.vibrate([200, 100, 200, 100, 200]);
                    } else if (score >= 80) {
                        navigator.vibrate([100, 50, 100]);
                    } else if (score >= 60) {
                        navigator.vibrate(100);
                    }
                }
            }
        };

        console.log('‚úÖ ScoreAnimator bet√∂ltve');
    </script>

    <!-- ‚úÖ BE√ÅGYAZOTT VISITOR COUNTER -->
    <script>
        // ‚úÖ BE√ÅGYAZOTT VISITOR COUNTER OSZT√ÅLY
        if (!window.VisitorCounter) {
            console.log('üîß VisitorCounter be√°gyaz√°sa...');
            
            class VisitorCounter {
                static STORAGE_KEY = 'perfectcircle_visits';
                static SESSION_KEY = 'perfectcircle_session';
                static currentCount = 0;
                static globalCount = 0;
                
                static async init() {
                    console.log('üëÅÔ∏è Be√°gyazott VisitorCounter inicializ√°l√°sa...');
                    
                    try {
                        // Helyi l√°togat√°ssz√°m friss√≠t√©se
                        this.currentCount = this.updateLocalVisitCount();
                        
                        // Firebase l√°togat√°s ment√©se (ha el√©rhet≈ë)
                        if (window.firebaseAPI && window.firebaseAPI.isReady && window.firebaseAPI.isReady()) {
                            await this.saveVisitToFirebase();
                            await this.loadGlobalVisitCount();
                        } else {
                            console.log('üì¥ Firebase nem el√©rhet≈ë, csak helyi sz√°ml√°l√≥');
                        }
                        
                        console.log('‚úÖ Be√°gyazott VisitorCounter inicializ√°lva');
                        return true;
                        
                    } catch (error) {
                        console.error('‚ùå Be√°gyazott VisitorCounter hiba:', error);
                        throw error;
                    }
                }
                
                static updateLocalVisitCount() {
                    let localVisits = parseInt(localStorage.getItem(this.STORAGE_KEY) || '0');
                    localVisits++;
                    localStorage.setItem(this.STORAGE_KEY, localVisits.toString());
                    
                    // Id≈ëpontok ment√©se
                    if (!localStorage.getItem('perfectcircle_first_visit')) {
                        localStorage.setItem('perfectcircle_first_visit', new Date().toISOString());
                    }
                    localStorage.setItem('perfectcircle_last_visit', new Date().toISOString());
                    
                    // DOM friss√≠t√©s
                    const visitElement = document.getElementById('visitCount');
                    if (visitElement) {
                        visitElement.textContent = localVisits.toLocaleString('hu-HU');
                    }
                    
                    console.log(`üìä Helyi l√°togat√°sok: ${localVisits}`);
                    return localVisits;
                }
                
                static async saveVisitToFirebase() {
                    if (!window.firebaseAPI || !window.firebaseAPI.saveVisit) {
                        console.log('üì¥ Firebase saveVisit nem el√©rhet≈ë');
                        return;
                    }
                    
                    try {
                        const visitData = {
                            timestamp: new Date().toISOString(),
                            date: new Date().toLocaleDateString('hu-HU'),
                            time: new Date().toLocaleTimeString('hu-HU'),
                            sessionId: this.getSessionId(),
                            userAgent: navigator.userAgent.substring(0, 200),
                            language: navigator.language,
                            screen: `${screen.width}x${screen.height}`,
                            viewport: `${window.innerWidth}x${window.innerHeight}`,
                            referrer: (document.referrer || 'k√∂zvetlen').substring(0, 200),
                            url: window.location.href,
                            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                            platform: navigator.platform
                        };
                        
                        await window.firebaseAPI.saveVisit(visitData);
                        console.log('‚úÖ L√°togat√°s mentve Firebase-be');
                        
                    } catch (error) {
                        console.error('‚ùå Firebase l√°togat√°s ment√©si hiba:', error);
                    }
                }
                
                static async loadGlobalVisitCount() {
                    if (!window.firebaseAPI || !window.firebaseAPI.getVisitCount) {
                        console.log('üì¥ Firebase getVisitCount nem el√©rhet≈ë');
                        return;
                    }
                    
                    try {
                        const globalCount = await window.firebaseAPI.getVisitCount();
                        this.globalCount = globalCount;
                        console.log(`üåç Glob√°lis l√°togat√°sok: ${globalCount}`);
                        
                    } catch (error) {
                        console.error('‚ùå Glob√°lis l√°togat√°ssz√°m lek√©r√©si hiba:', error);
                    }
                }
                
                static getSessionId() {
                    let sessionId = sessionStorage.getItem(this.SESSION_KEY);
                    if (!sessionId) {
                        sessionId = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
                        sessionStorage.setItem(this.SESSION_KEY, sessionId);
                    }
                    return sessionId;
                }
                
                static getCurrentCount() {
                    return this.currentCount;
                }
                
                static getGlobalCount() {
                    return this.globalCount;
                }
                
                static showStats() {
                    const localVisits = localStorage.getItem(this.STORAGE_KEY) || 0;
                    const firstVisit = localStorage.getItem('perfectcircle_first_visit');
                    const lastVisit = localStorage.getItem('perfectcircle_last_visit');
                    
                    let message = `üë• L√°togat√°si statisztik√°k:\n\n`;
                    message += `üî¢ Helyi l√°togat√°sok: ${localVisits}\n`;
                    
                    if (this.globalCount > 0) {
                        message += `üåç Glob√°lis l√°togat√°sok: ${this.globalCount.toLocaleString('hu-HU')}\n`;
                    }
                    
                    if (firstVisit) {
                        const firstDate = new Date(firstVisit);
                        message += `üÜï Els≈ë l√°togat√°s: ${firstDate.toLocaleDateString('hu-HU')}\n`;
                    }
                    
                    if (lastVisit) {
                        const lastDate = new Date(lastVisit);
                        message += `üïê Utols√≥ l√°togat√°s: ${lastDate.toLocaleDateString('hu-HU')} ${lastDate.toLocaleTimeString('hu-HU')}\n`;
                    }
                    
                    const sessionId = this.getSessionId();
                    message += `üÜî Session ID: ${sessionId.substring(0, 8)}...`;
                    
                    alert(message);
                }
            }
            
            // Glob√°lis export
            window.VisitorCounter = VisitorCounter;
            console.log('‚úÖ Be√°gyazott VisitorCounter l√©trehozva');
        }
    </script>

    <script src="js/i18n/languageDetector.js"></script>
    <script src="js/i18n/i18nManager.js"></script>
    
    <!-- Firebase Scripts -->
    <script src="js/firebase/firebase-config.js" type="module"></script>
    
    <!-- Utility Scripts -->
    <script src="js/utils/audioManager.js"></script>
    <script src="js/utils/effectsManager.js"></script>
    
    <!-- Game Scripts -->
    <script src="js/game/transformations.js"></script>
    <script src="js/game/circleAnalyzer.js"></script>
    <script src="js/game/gameEngine.js"></script>
    
    <!-- Manager Scripts -->
    <script src="js/managers/scoreManager.js"></script>
    <script src="js/managers/visitorCounter.js"></script>
    <script src="js/managers/leaderboardManager.js"></script>

    <script src="leaderboard-fix.js"></script>

    <!-- Main App Script UTOLJ√ÅRA -->
    <script src="js/app.js" type="module"></script>

    <!-- FIREBASE GLOB√ÅLIS LEADERBOARD T√ÅMOGAT√ÅS -->
    <script>
        // V√°rakoz√°s a Firebase API-ra
        function waitForFirebaseAPI() {
            return new Promise((resolve) => {
                let attempts = 0;
                const maxAttempts = 100;
                
                const checkAPI = () => {
                    attempts++;
                    
                    if (window.firebaseAPI && typeof window.firebaseAPI.isReady === 'function') {
                        console.log('‚úÖ Firebase API el√©rhet≈ë glob√°lis leaderboard-hoz!');
                        resolve(true);
                    } else if (attempts >= maxAttempts) {
                        console.error('‚ùå Firebase API timeout!');
                        resolve(false);
                    } else {
                        setTimeout(checkAPI, 100);
                    }
                };
                checkAPI();
            });
        }

        // ‚úÖ JAV√çTOTT GLOB√ÅLIS LEADERBOARD BET√ñLT√âSE
        window.loadGlobalLeaderboard = async function() {
            console.log('üåç Glob√°lis leaderboard bet√∂lt√©se...');
            
            // ‚úÖ AZONNAL BE√ÅLL√çTJUK A T√çPUST
            window.currentLeaderboardType = 'global';
            
            const leaderboardList = document.getElementById('leaderboardList');
            const leaderboardStatus = document.getElementById('leaderboardStatus');
            
            if (!leaderboardList) return;
            
            // Loading √°llapot
            leaderboardList.innerHTML = '<div class="score-entry">üîÑ Glob√°lis eredm√©nyek bet√∂lt√©se...</div>';
            if (leaderboardStatus) {
                leaderboardStatus.textContent = 'üåç Glob√°lis eredm√©nyek bet√∂lt√©se...';
            }
            
            try {
                // V√°runk a Firebase API-ra
                const apiReady = await waitForFirebaseAPI();
                
                if (!apiReady || !window.firebaseAPI.isReady()) {
                    throw new Error('Firebase nem el√©rhet≈ë');
                }
                
                // Glob√°lis eredm√©nyek lek√©r√©se
                const globalScores = await window.firebaseAPI.getTopScores(20);
                
                console.log('‚úÖ Glob√°lis eredm√©nyek bet√∂ltve:', globalScores.length);
                
                // ‚úÖ ELLEN≈êRIZZ√úK HOGY M√âG MINDIG GLOB√ÅLIS M√ìDBAN VAGYUNK
                if (window.currentLeaderboardType !== 'global') {
                    console.log('‚ö†Ô∏è M√°r nem glob√°lis m√≥dban vagyunk, le√°ll√≠t√°s...');
                    return;
                }
                
                // Status friss√≠t√©s
                if (leaderboardStatus) {
                    leaderboardStatus.textContent = `üåç ${globalScores.length} glob√°lis eredm√©ny`;
                }
                
                // Lista megjelen√≠t√©se
                if (globalScores.length === 0) {
                    leaderboardList.innerHTML = `
                        <div class="score-entry">
                            <span>üåç M√©g nincsenek glob√°lis eredm√©nyek</span>
                        </div>
                    `;
                } else {
                    leaderboardList.innerHTML = globalScores.map((score, index) => {
                        // D√°tum form√°z√°sa
                        let dateText = 'Ma';
                        if (score.timestamp && score.timestamp.seconds) {
                            const date = new Date(score.timestamp.seconds * 1000);
                            dateText = date.toLocaleDateString('hu-HU');
                        } else if (score.date) {
                            dateText = score.date;
                        }
                        
                        // Thumbnail kezel√©se
                        const thumbnailHTML = score.thumbnail ? 
                            `<div class="thumbnail-container">
                                <img src="${score.thumbnail}" 
                                     class="leaderboard-thumbnail" 
                                     style="width: 40px; height: 40px; object-fit: cover; border-radius: 6px; cursor: pointer;" 
                                     onclick="window.ThumbnailGenerator.showThumbnailModal('${score.thumbnail}')"
                                     title="Kattints a nagy√≠t√°shoz">
                            </div>` : 
                            `<div class="thumbnail-container">
                                <div class="no-thumbnail" style="width: 40px; height: 40px; background: linear-gradient(45deg, #f0f0f0, #e0e0e0); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #999;">üåç</div>
                            </div>`;
                        
                        return `
                            <div class="leaderboard-entry global-entry" data-score-id="${score.id}">
                                ${thumbnailHTML}
                                <div class="entry-content">
                                    <div class="entry-main">
                                        <span class="rank" style="font-weight: bold; color: #666; min-width: 30px;">#${index + 1}</span>
                                        <span class="name" style="font-weight: 500; color: #333; margin-right: 8px;">${score.playerName || 'N√©vtelen'}</span>
                                        <span class="score" style="font-weight: bold; color: #4CAF50; margin-left: auto;">${score.score} pont</span>
                                    </div>
                                    <div class="entry-details">
                                        <span style="color: #888;">üåç ${dateText}</span>
                                        ${score.transformation ? ` ‚Ä¢ <span style="color: #666;">üé® ${score.transformation}</span>` : ''}
                                        ${score.difficulty && score.difficulty !== 'easy' ? ` ‚Ä¢ <span style="color: #ff9800;">üåÄ ${score.difficulty}</span>` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
            } catch (error) {
                console.error('‚ùå Glob√°lis leaderboard bet√∂lt√©si hiba:', error);
                
                // ‚úÖ ELLEN≈êRIZZ√úK HOGY M√âG MINDIG GLOB√ÅLIS M√ìDBAN VAGYUNK
                if (window.currentLeaderboardType !== 'global') {
                    console.log('‚ö†Ô∏è M√°r nem glob√°lis m√≥dban vagyunk, hiba megjelen√≠t√©s kihagyva...');
                    return;
                }
                
                // Hiba megjelen√≠t√©se
                leaderboardList.innerHTML = `
                    <div class="score-entry" style="color: #f44336;">
                        <span>‚ùå Hiba a glob√°lis eredm√©nyek bet√∂lt√©sekor</span>
                        <div style="font-size: 12px; margin-top: 5px; color: #666;">
                            ${error.message}
                        </div>
                    </div>
                `;
                
                if (leaderboardStatus) {
                    leaderboardStatus.textContent = '‚ùå Glob√°lis eredm√©nyek nem el√©rhet≈ëk';
                }
            }
        };

        // Firebase score ment√©s glob√°lisan
// A showScore f√ºggv√©nyben (m√°r van, de ellen≈ërizz√ºk):
// ‚úÖ JAV√çTOTT - csak √°tadja az adatot, nem k√©sz√≠t √∫j thumbnail-t
window.saveScoreToFirebase = async function(scoreData) {
    try {
        if (!window.firebaseAPI || !window.firebaseAPI.isReady()) {
            console.log('‚ö†Ô∏è Firebase nem el√©rhet≈ë, score nem mentve glob√°lisan');
            return null;
        }
        
        console.log('üì§ Firebase ment√©s ind√≠t√°sa:', {
            playerName: scoreData.playerName,
            score: scoreData.score,
            hasThumbnail: !!scoreData.thumbnail,
            thumbnailSize: scoreData.thumbnail ? Math.round(scoreData.thumbnail.length / 1024) + 'KB' : 'nincs'
        });
        
        const result = await window.firebaseAPI.saveScore(scoreData);
        console.log('‚úÖ Score mentve Firebase-be:', result?.id);
        return result;
        
    } catch (error) {
        console.error('‚ùå Firebase score ment√©si hiba:', error);
        return null;
    }
};


    </script>

    <!-- Inicializ√°l√°s -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üåç DOM bet√∂ltve, i18n inicializ√°l√°s...');
            
            if (window.languageData && window.languageData.hu) {
                window.simpleTranslate = function(key, params = {}) {
                    const keys = key.split('.');
                    let value = window.languageData.hu;
                    
                    for (const k of keys) {
                        if (value && typeof value === 'object' && value[k] !== undefined) {
                            value = value[k];
                        } else {
                            return key;
                        }
                    }
                    
                    if (typeof value === 'string' && params) {
                        Object.keys(params).forEach(param => {
                            value = value.replace(`{${param}}`, params[param]);
                        });
                    }
                    
                    return value;
                };
                
                document.querySelectorAll('[data-i18n]').forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    const translation = window.simpleTranslate(key);
                    
                    if (translation && translation !== key) {
                        if (element.tagName === 'INPUT' && element.type === 'text') {
                            element.placeholder = translation;
                        } else {
                            element.innerHTML = translation;
                        }
                    }
                });
                
                console.log('‚úÖ Egyszer≈±s√≠tett i18n inicializ√°lva');
            }
        });
    </script>

    <!-- ‚úÖ JAV√çTOTT LEADERBOARD F√úGGV√âNYEK -->
    <script>
        // ‚úÖ AUTOMATIKUS LEADERBOARD FRISS√çT≈ê THUMBNAILOKKAL - V√âDETT VERZI√ì
        window.refreshLeaderboard = function() {
            try {
                // ‚úÖ ELLEN≈êRIZZ√úK A LEADERBOARD T√çPUST
                if (window.currentLeaderboardType === 'global') {
                    console.log('üõ°Ô∏è V√âDELEM: refreshLeaderboard blokkolva glob√°lis m√≥dban');
                    return;
                }
                
                const leaderboardList = document.getElementById('leaderboardList');
                const leaderboardStatus = document.getElementById('leaderboardStatus');
                
                if (!leaderboardList || !window.ScoreManager) return;
                
                const scores = window.ScoreManager.getScores();
                
                // Status friss√≠t√©s
                if (leaderboardStatus) {
                    leaderboardStatus.textContent = `üì± ${scores.length} helyi eredm√©ny`;
                }
                
                // Lista friss√≠t√©s
                if (scores.length === 0) {
                    leaderboardList.innerHTML = `
                        <div class="score-entry">
                            <span>M√©g nincsenek eredm√©nyek</span>
                        </div>
                    `;
                } else {
                    leaderboardList.innerHTML = scores.map((score, index) => {
                        const thumbnailHTML = score.thumbnail ? 
                            `<div class="thumbnail-container">
                                <img src="${score.thumbnail}" 
                                     class="leaderboard-thumbnail" 
                                     style="width: 40px; height: 40px; object-fit: cover; border-radius: 6px; cursor: pointer;" 
                                     onclick="window.ThumbnailGenerator.showThumbnailModal('${score.thumbnail}')"
                                     title="Kattints a nagy√≠t√°shoz">
                            </div>` : 
                            `<div class="thumbnail-container">
                                <div class="no-thumbnail" style="width: 40px; height: 40px; background: linear-gradient(45deg, #f0f0f0, #e0e0e0); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #999;">üé®</div>
                            </div>`;
                        
                        return `
                            <div class="leaderboard-entry local-entry" data-score-id="${score.id}">
                                ${thumbnailHTML}
                                <div class="entry-content">
                                    <div class="entry-main">
                                        <span class="rank" style="font-weight: bold; color: #666; min-width: 30px;">#${index + 1}</span>
                                        <span class="name" style="font-weight: 500; color: #333; margin-right: 8px;">${score.playerName || 'N√©vtelen'}</span>
                                        <span class="score" style="font-weight: bold; color: #4CAF50; margin-left: auto;">${score.score} pont</span>
                                    </div>
                                    <div class="entry-details">
                                        <span style="color: #888;">${score.date || 'Ma'}</span>
                                        ${score.transformation ? ` ‚Ä¢ <span style="color: #666;">üé® ${score.transformation}</span>` : ''}
                                        ${score.difficulty && score.difficulty !== 'easy' ? ` ‚Ä¢ <span style="color: #ff9800;">üåÄ ${score.difficulty}</span>` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                console.log(`‚úÖ Leaderboard friss√≠tve thumbnailokkal: ${scores.length} eredm√©ny`);
                
            } catch (error) {
                console.error('‚ùå Leaderboard friss√≠t√©si hiba:', error);
            }
        };

        // ‚úÖ FELT√âTELES AUTOMATIKUS FRISS√çT√âS
        let refreshInterval = null;
        
        function startLocalRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            refreshInterval = setInterval(() => {
                if (window.currentLeaderboardType === 'local') {
                    window.refreshLeaderboard();
                }
            }, 3000); // 3 m√°sodpercenk√©nt
            console.log('‚úÖ Helyi leaderboard automatikus friss√≠t≈ë elind√≠tva');
        }
        
        function stopLocalRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
                console.log('üõë Helyi leaderboard automatikus friss√≠t≈ë le√°ll√≠tva');
            }
        }

        // ‚úÖ JAV√çTOTT SWITCHLEADERBOARD F√úGGV√âNY
        window.switchLeaderboard = function(type) {
            console.log('üîÑ HTML switchLeaderboard h√≠v√°s:', type);
            
            // ‚úÖ AZONNAL BE√ÅLL√çTJUK A T√çPUST
            window.currentLeaderboardType = type;
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            const targetTab = document.getElementById(type + 'Tab');
            if (targetTab) targetTab.classList.add('active');
            
            const listContainer = document.getElementById('leaderboardList');
            const statusContainer = document.getElementById('leaderboardStatus');
            
            if (statusContainer) {
                statusContainer.textContent = type === 'local' ? 'üì± Helyi eredm√©nyek' : 'üåç Glob√°lis eredm√©nyek';
            }
            
            if (listContainer) {
                if (type === 'local') {
                    startLocalRefresh(); // Helyi friss√≠t≈ë bekapcsol√°sa
                    window.refreshLeaderboard();
                } else {
                    stopLocalRefresh(); // Helyi friss√≠t≈ë kikapcsol√°sa
                    window.loadGlobalLeaderboard();
                }
            }
        };

        // Ind√≠t√°s
        setTimeout(startLocalRefresh, 2000);
    </script>

    <!-- SHOWSCORE FEL√úL√çR√ÅSA FIREBASE MENT√âSSEL -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                console.log('üîÑ showScore fel√ºl√≠r√°sa Firebase t√°mogat√°ssal...');
                
                // √öJ showScore f√ºggv√©ny Firebase ment√©ssel
                window.showScore = async function(score, analysis, transformationName = '') {
                    console.log('üèÜ √öJ showScore h√≠vva Firebase ment√©ssel:', { score, analysis, transformationName });
                    
                    try {
                        // Score valid√°l√°s
                        const roundedScore = Math.round(Number(score));
                        if (isNaN(roundedScore)) {
                            console.error('‚ùå √ârv√©nytelen score:', score);
                            return;
                        }
                        
                        // SCORE ANIM√ÅCI√ì IND√çT√ÅSA
                        if (window.ScoreAnimator) {
                            window.ScoreAnimator.animateScore(roundedScore, analysis, transformationName);
                            window.ScoreAnimator.vibrate(roundedScore);
                        }
                        
                        // UI elemek friss√≠t√©se
                        setTimeout(() => {
                            const elements = {
                                scoreDisplay: document.getElementById('scoreDisplay'),
                                finalScore: document.getElementById('finalScore'),
                                currentScore: document.getElementById('currentScore'),
                                scoreBreakdown: document.getElementById('scoreBreakdown')
                            };
                            
                            if (elements.finalScore) elements.finalScore.textContent = roundedScore;
                            if (elements.currentScore) elements.currentScore.textContent = roundedScore;
                            
                            if (elements.scoreBreakdown && analysis) {
                                let breakdownHTML = '';
                                if (analysis.shape !== undefined) breakdownHTML += `<div>üîµ K√∂ralak: ${Math.round(analysis.shape)}/40</div>`;
                                if (analysis.closure !== undefined) breakdownHTML += `<div>üîó Z√°r√≥d√°s: ${Math.round(analysis.closure)}/20</div>`;
                                if (analysis.smoothness !== undefined) breakdownHTML += `<div>üåä Egyenletess√©g: ${Math.round(analysis.smoothness)}/25</div>`;
                                if (analysis.size !== undefined) breakdownHTML += `<div>üìè M√©ret: ${Math.round(analysis.size)}/15</div>`;
                                elements.scoreBreakdown.innerHTML = breakdownHTML;
                            }
                            
                            if (elements.scoreDisplay) {
                                elements.scoreDisplay.style.display = 'block';
                                elements.scoreDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }
                        }, 2500);
                        
                        // THUMBNAIL K√âSZ√çT√âSE √âS MENT√âS
                        if (roundedScore > 0 && window.ScoreManager && window.ThumbnailGenerator) {
                            console.log('üíæ Score ment√©se thumbnaillal √©s Firebase-be...');
                            
                            const thumbnail = await window.ThumbnailGenerator.captureTransformationThumbnail(1000);
                            const difficulty = window.gameEngine?.getDifficulty() || 'easy';
                            const playerName = document.getElementById('playerName')?.value?.trim() || 'N√©vtelen';
                            
                            // Helyi ment√©s
                            let savedScore;
                            if (window.ScoreManager.saveScore.length >= 5) {
                                savedScore = window.ScoreManager.saveScore(
                                    roundedScore,
                                    analysis,
                                    difficulty,
                                    transformationName,
                                    thumbnail
                                );
                            } else {
                                savedScore = window.ScoreManager.saveScore(
                                    roundedScore,
                                    analysis,
                                    difficulty,
                                    transformationName
                                );
                                
                                if (thumbnail && savedScore && savedScore.id) {
                                    const scores = window.ScoreManager.getScores();
                                    const scoreIndex = scores.findIndex(s => s.id === savedScore.id);
                                    if (scoreIndex !== -1) {
                                        scores[scoreIndex].thumbnail = thumbnail;
                                        localStorage.setItem('perfectcircle_scores', JSON.stringify(scores));
                                    }
                                }
                            }
                            
                            // Firebase ment√©s
                            const firebaseData = {
                                playerName: playerName,
                                score: roundedScore,
                                difficulty: difficulty,
                                transformation: transformationName,
                                thumbnail: thumbnail
                            };
                            
                            const firebaseResult = await window.saveScoreToFirebase(firebaseData);
                            if (firebaseResult) {
                                console.log('‚úÖ Score mentve Firebase-be is:', firebaseResult);
                            }
                            
                            console.log('‚úÖ Score mentve thumbnaillal:', savedScore);
                            
                            // Thumbnail megjelen√≠t√©se
                            setTimeout(() => {
                                const scoreDisplay = document.getElementById('scoreDisplay');
                                if (thumbnail && scoreDisplay) {
                                    window.ThumbnailGenerator.displayThumbnail(thumbnail, 'scoreDisplay', 'current-score-thumbnail');
                                }
                            }, 3000);
                            
                            // ‚úÖ LEADERBOARD FRISS√çT√âSE - CSAK HELYI M√ìDBAN
                            setTimeout(() => {
                                if (window.currentLeaderboardType === 'local') {
                                    window.refreshLeaderboard();
                                    console.log('üîÑ Helyi leaderboard friss√≠tve showScore ut√°n');
                                } else {
                                    console.log('üåç Glob√°lis m√≥dban vagyunk, helyi leaderboard friss√≠t√©s kihagyva');
                                }
                            }, 100);
                            
                            // Statisztik√°k friss√≠t√©se
                            setTimeout(() => {
                                if (window.updateStats) {
                                    window.updateStats();
                                }
                            }, 200);
                        }
                        
                    } catch (error) {
                        console.error('‚ùå showScore hiba:', error);
                    }
                };
                
                console.log('‚úÖ showScore sikeresen fel√ºl√≠rva Firebase t√°mogat√°ssal');
                
            }, 1000);
        });
    </script>
<!-- RAJZ M√ìD INTEGR√ÅCI√ì -->
<script>
// Eredeti showScore ment√©se
const originalShowScore = window.showScore;

// M√≥dos√≠tott showScore rajz m√≥d t√°mogat√°ssal
window.showScore = async function(score, analysis, transformationName = '') {
    // Rajz m√≥d kezel√©se
    if (window.GameModeManager && window.GameModeManager.currentMode === 'drawing') {
        const shapeScore = window.GameModeManager.evaluateShape(window.lastDrawnPoints || []);
        
        if (shapeScore !== null) {
            // Rajz m√≥d specifikus score kezel√©s
            console.log('üé® Rajz m√≥d score:', shapeScore);
            return;
        }
    }
    
    // Eredeti k√∂r m√≥d
    if (originalShowScore) {
        return originalShowScore(score, analysis, transformationName);
    }
};

// Rajzolt pontok t√°rol√°sa
let lastDrawnPoints = [];
window.lastDrawnPoints = lastDrawnPoints;

// Canvas rajzol√°s figyel√©se (ha van gameEngine)
if (window.gameEngine) {
    const originalFinishDrawing = window.gameEngine.finishDrawing;
    
    window.gameEngine.finishDrawing = function() {
        // Rajzolt pontok ment√©se
        if (this.path && this.path.length > 0) {
            window.lastDrawnPoints = [...this.path];
        }
        
        // Eredeti f√ºggv√©ny h√≠v√°sa
        if (originalFinishDrawing) {
            return originalFinishDrawing.call(this);
        }
    };
}

console.log('‚úÖ Rajz m√≥d integr√°ci√≥ bet√∂ltve');
</script>

    <!-- ‚úÖ VISITOR COUNTER INICIALIZ√ÅL√ÅS -->
    <script>
        // ‚úÖ VISITOR COUNTER INICIALIZ√ÅL√ÅS - JAV√çTOTT VERZI√ì
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîÑ VisitorCounter inicializ√°l√°s ind√≠t√°sa...');
            
            // V√°rjunk egy kicsit, hogy minden script bet√∂lt≈ëdj√∂n
            setTimeout(() => {
                initVisitorCounterWithRetry();
            }, 2000);
        });
        
        function initVisitorCounterWithRetry() {
            let attempts = 0;
            const maxAttempts = 20; // Cs√∂kkentve
            
            const tryInit = () => {
                attempts++;
                console.log(`üîÑ VisitorCounter k√≠s√©rlet ${attempts}/${maxAttempts}...`);
                
                // Ellen≈ërizz√ºk hogy l√©tezik-e a VisitorCounter
                if (window.VisitorCounter) {
                    console.log('‚úÖ VisitorCounter megtal√°lva!');
                    console.log('- T√≠pus:', typeof window.VisitorCounter);
                    console.log('- Init met√≥dus:', typeof window.VisitorCounter.init);
                    
                    if (typeof window.VisitorCounter.init === 'function') {
                        console.log('üöÄ VisitorCounter.init() h√≠v√°sa...');
                        
                        window.VisitorCounter.init()
                            .then(() => {
                                console.log('‚úÖ VisitorCounter sikeresen inicializ√°lva!');
                            })
                            .catch(error => {
                                console.error('‚ùå VisitorCounter init hiba:', error);
                                startFallbackCounter();
                            });
                        return;
                    } else {
                        console.error('‚ùå VisitorCounter.init nem f√ºggv√©ny!');
                    }
                }
                
                // Ha m√©g nem √©rhet≈ë el √©s van m√©g k√≠s√©rlet
                if (attempts < maxAttempts) {
                    setTimeout(tryInit, 200);
                } else {
                    console.warn('‚ö†Ô∏è VisitorCounter nem tal√°lhat√≥, fallback ind√≠t√°sa...');
                    startFallbackCounter();
                }
            };
            
            tryInit();
        }
        
        function startFallbackCounter() {
            console.log('üîÑ Fallback visitor counter ind√≠t√°sa...');
            
            try {
                let visits = parseInt(localStorage.getItem('perfectcircle_visits') || '0');
                visits++;
                localStorage.setItem('perfectcircle_visits', visits.toString());
                localStorage.setItem('perfectcircle_last_visit', new Date().toISOString());
                
                if (!localStorage.getItem('perfectcircle_first_visit')) {
                    localStorage.setItem('perfectcircle_first_visit', new Date().toISOString());
                }
                
                const visitCountElement = document.getElementById('visitCount');
                if (visitCountElement) {
                    visitCountElement.textContent = visits;
                    console.log('‚úÖ Visitor count friss√≠tve DOM-ban:', visits);
                } else {
                    console.error('‚ùå visitCount elem nem tal√°lhat√≥!');
                }
                
                console.log('üë• Fallback l√°togat√°ssz√°ml√°l√≥ inicializ√°lva:', visits);
                
            } catch (error) {
                console.error('‚ùå Fallback counter hiba:', error);
            }
        }
    </script>

    <!-- EGY√âB SEG√âDF√úGGV√âNYEK -->
    <script>
        window.updateStats = function() {
            console.log('üìä updateStats called');
            
            if (window.ScoreManager) {
                const stats = window.ScoreManager.getStats();
                
                const currentScore = document.getElementById('currentScore');
                const bestScore = document.getElementById('bestScore');
                const gamesPlayed = document.getElementById('gamesPlayed');
                const averageScore = document.getElementById('averageScore');
                
                if (currentScore) currentScore.textContent = stats.currentScore || 0;
                if (bestScore) bestScore.textContent = stats.best || 0;
                if (gamesPlayed) gamesPlayed.textContent = stats.games || 0;
                if (averageScore) averageScore.textContent = Math.round(stats.average) || 0;
                
                console.log('‚úÖ Statisztik√°k friss√≠tve:', stats);
            } else {
                console.log('‚ö†Ô∏è ScoreManager nem el√©rhet≈ë');
            }
        };

        window.showVisitStats = function() {
            console.log('üìä L√°togat√°si statisztik√°k lek√©r√©se...');
            
            if (window.VisitorCounter && typeof window.VisitorCounter.showStats === 'function') {
                // Firebase-alap√∫ statisztik√°k
                window.VisitorCounter.showStats();
            } else {
                // Fallback helyi statisztik√°k
                const visitCount = localStorage.getItem('perfectcircle_visits') || 0;
                const firstVisit = localStorage.getItem('perfectcircle_first_visit');
                const lastVisit = localStorage.getItem('perfectcircle_last_visit');
                
                let message = `üë• Helyi l√°togat√°si statisztik√°k:\n\n`;
                message += `üî¢ Helyi l√°togat√°sok: ${visitCount}\n`;
                
                if (firstVisit) {
                    const firstDate = new Date(firstVisit);
                    message += `üÜï Els≈ë helyi l√°togat√°s: ${firstDate.toLocaleDateString('hu-HU')}\n`;
                }
                
                if (lastVisit) {
                    const lastDate = new Date(lastVisit);
                    message += `üïê Utols√≥ l√°togat√°s: ${lastDate.toLocaleDateString('hu-HU')} ${lastDate.toLocaleTimeString('hu-HU')}\n\n`;
                }
                
                message += `‚ö†Ô∏è Firebase l√°togat√°ssz√°ml√°l√≥ nem el√©rhet≈ë.`;
                
                alert(message);
            }
        };

        window.setDifficulty = function(level) {
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.querySelector(`[data-difficulty="${level}"]`);
            if (activeBtn) activeBtn.classList.add('active');
            
            localStorage.setItem('perfectcircle_difficulty', level);
            
            if (window.gameEngine && window.gameEngine.setDifficulty) {
                window.gameEngine.setDifficulty(level);
            }
            
            console.log(`‚úÖ Neh√©zs√©g be√°ll√≠tva: ${level}`);
        };
    </script>

    <!-- ‚úÖ VISITOR COUNTER DEBUG -->
    <script>
        // ‚úÖ VISITOR COUNTER DEBUG
        window.debugVisitorCounter = function() {
            console.log('üîç === VISITOR COUNTER DEBUG ===');
            console.log('- window.VisitorCounter:', !!window.VisitorCounter);
            console.log('- VisitorCounter t√≠pusa:', typeof window.VisitorCounter);
            console.log('- VisitorCounter.init:', typeof window.VisitorCounter?.init);
            
            if (window.VisitorCounter) {
                console.log('- VisitorCounter met√≥dusok:', Object.getOwnPropertyNames(window.VisitorCounter));
            }
            
            // Script f√°jlok ellen≈ërz√©se
            const scripts = Array.from(document.querySelectorAll('script[src]'));
            const visitorScript = scripts.find(s => s.src.includes('visitorCounter'));
            console.log('- VisitorCounter script bet√∂ltve:', !!visitorScript);
            
            if (visitorScript) {
                console.log('- Script src:', visitorScript.src);
                console.log('- Script loaded:', !visitorScript.hasAttribute('async') || visitorScript.readyState === 'complete');
            }
            
            // Helyi adatok
            const localVisits = localStorage.getItem('perfectcircle_visits');
            console.log('- Helyi l√°togat√°sok:', localVisits);
            
            // DOM elem
            const visitElement = document.getElementById('visitCount');
            console.log('- Visit count elem:', !!visitElement);
            console.log('- Jelenlegi √©rt√©k:', visitElement?.textContent);
            
            console.log('=== DEBUG V√âGE ===');
        };
        
        // Automatikus debug 3 m√°sodperc ut√°n
        setTimeout(() => {
            console.log('üîç Automatikus VisitorCounter debug...');
            window.debugVisitorCounter();
        }, 3000);
    </script>

    <!-- EMERGENCY BUTTON HANDLERS -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîß Emergency button handlers loading...');
            
            // Leaderboard tabok
            const localTab = document.getElementById('localTab');
            const globalTab = document.getElementById('globalTab');
            
            if (localTab) {
                localTab.addEventListener('click', function() {
                    console.log('Local tab clicked');
                    window.switchLeaderboard('local');
                });
            }
            
            if (globalTab) {
                globalTab.addEventListener('click', function() {
                    console.log('Global tab clicked');
                    window.switchLeaderboard('global');
                });
            }
            
            // Start gomb
            const startBtn = document.getElementById('startBtn');
            if (startBtn) {
                startBtn.addEventListener('click', function() {
                    console.log('Start button clicked');
                    if (window.gameEngine && typeof window.gameEngine.startDrawing === 'function') {
                        window.gameEngine.startDrawing();
                    } else {
                        console.log('GameEngine not ready');
                    }
                });
            }
            
            // Clear gomb
            const clearBtn = document.getElementById('clearBtn');
            if (clearBtn) {
                clearBtn.addEventListener('click', function() {
                    console.log('Clear button clicked');
                    if (window.gameEngine && typeof window.gameEngine.clearCanvas === 'function') {
                        window.gameEngine.clearCanvas();
                    } else {
                        console.log('GameEngine not ready');
                    }
                });
            }
            
            // Help gomb
            const helpBtn = document.getElementById('helpBtn');
            if (helpBtn) {
                helpBtn.addEventListener('click', function() {
                    console.log('Help button clicked');
                    alert('üéØ PERFECT CIRCLE\n\nRajzolj t√∂k√©letes k√∂rt egyetlen mozdulattal!\n\nüéÆ Ir√°ny√≠t√°s:\n‚Ä¢ Eg√©r: Kattints √©s h√∫zd\n‚Ä¢ Mobil: √ârintsd √©s h√∫zd\n\nüèÜ Pontsz√°m√≠t√°s:\n‚Ä¢ K√∂ralak (40p)\n‚Ä¢ Z√°r√≥d√°s (20p)\n‚Ä¢ Egyenletess√©g (25p)\n‚Ä¢ M√©ret (15p)\n\nSok sikert! üçÄ');
                });
            }
            
            // Save Name gomb
            const saveNameBtn = document.getElementById('saveNameBtn');
            if (saveNameBtn) {
                saveNameBtn.addEventListener('click', function() {
                    console.log('Save name button clicked');
                    const input = document.getElementById('playerName');
                    const name = input ? input.value.trim() : '';
                    if (name) {
                        localStorage.setItem('perfectcircle_playername', name);
                        alert('N√©v mentve: ' + name + ' ‚úÖ');
                    } else {
                        alert('K√©rlek add meg a neved! ‚ùå');
                    }
                });
            }
            
            // Clear Scores gomb
            const clearScoresBtn = document.getElementById('clearScoresBtn');
            if (clearScoresBtn) {
                clearScoresBtn.addEventListener('click', function() {
                    console.log('Clear scores button clicked');
                    if (confirm('Biztosan t√∂r√∂lni szeretn√©d az √∂sszes helyi eredm√©nyt?')) {
                        if (window.ScoreManager && window.ScoreManager.clearScores) {
                            window.ScoreManager.clearScores();
                            alert('Helyi eredm√©nyek t√∂r√∂lve! ‚úÖ');
                            
                            // Statisztik√°k friss√≠t√©se
                            if (window.updateStats) {
                                window.updateStats();
                            }
                            
                            // Leaderboard friss√≠t√©se
                            if (window.currentLeaderboardType === 'local') {
                                window.refreshLeaderboard();
                            }
                        } else {
                            alert('ScoreManager nem el√©rhet≈ë! ‚ùå');
                        }
                    }
                });
            }
            
            console.log('‚úÖ Emergency button handlers loaded');
        });

        // Emergency global functions
        window.startDrawing = function() {
            console.log('Global startDrawing called');
            if (window.gameEngine && window.gameEngine.startDrawing) {
                window.gameEngine.startDrawing();
            } else {
                console.log('GameEngine not ready for startDrawing');
            }
        };

        window.clearCanvas = function() {
            console.log('Global clearCanvas called');
            if (window.gameEngine && window.gameEngine.clearCanvas) {
                window.gameEngine.clearCanvas();
            } else {
                console.log('GameEngine not ready for clearCanvas');
            }
        };

        window.showInstructions = function() {
            console.log('Global showInstructions called');
            alert('üéØ PERFECT CIRCLE\n\nRajzolj t√∂k√©letes k√∂rt egyetlen mozdulattal!');
        };

        window.savePlayerName = function() {
            console.log('Global savePlayerName called');
            const input = document.getElementById('playerName');
            const name = input ? input.value.trim() : '';
            if (name) {
                localStorage.setItem('perfectcircle_playername', name);
                alert('N√©v mentve: ' + name);
                return true;
            } else {
                alert('Add meg a neved!');
                return false;
            }
        };

        window.clearAllScores = function() {
            console.log('Global clearAllScores called');
            if (confirm('Biztosan t√∂r√∂lni szeretn√©d az √∂sszes helyi eredm√©nyt?')) {
                if (window.ScoreManager && window.ScoreManager.clearScores) {
                    window.ScoreManager.clearScores();
                    alert('Helyi eredm√©nyek t√∂r√∂lve!');
                    if (window.currentLeaderboardType === 'local') {
                        window.refreshLeaderboard();
                    }
                } else {
                    alert('ScoreManager nem el√©rhet≈ë!');
                }
            }
        };
    </script>

</body>
</html>
